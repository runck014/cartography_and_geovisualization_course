import {
  t
} from "./chunk-Q4J5AN2X.js";
import {
  m,
  n,
  n2
} from "./chunk-BN24XFSK.js";
import {
  Xe
} from "./chunk-NWZXTYBZ.js";
import "./chunk-UK4PA5E2.js";
import "./chunk-D4XQN7BI.js";
import "./chunk-C5QEEP7V.js";
import "./chunk-XECP56E2.js";
import "./chunk-ZTENQQ25.js";
import "./chunk-TGFVKJXH.js";
import "./chunk-ZZTUJWOP.js";
import "./chunk-SVRTKGNR.js";
import "./chunk-JED7FM2Q.js";
import "./chunk-FFUKJAFO.js";
import "./chunk-H4E2VVPD.js";
import "./chunk-CQFC4JO6.js";
import "./chunk-VS5MKM3H.js";
import "./chunk-CQTV4C3X.js";
import "./chunk-764E6KTP.js";
import "./chunk-GEPD6W23.js";
import "./chunk-QSIT7EPR.js";
import "./chunk-TP6LRQ42.js";
import "./chunk-ZE6OS33V.js";
import "./chunk-MWZJIOOL.js";
import "./chunk-ULSRCITK.js";
import "./chunk-FLUE3DMC.js";
import "./chunk-5GQ62KHN.js";
import "./chunk-YAGJS3MX.js";
import "./chunk-43KBLSS3.js";
import "./chunk-WH2FR6UE.js";
import "./chunk-RG7AMCT5.js";
import "./chunk-PV3ZZQOV.js";
import "./chunk-SM2VXWMT.js";
import "./chunk-WYO25WZZ.js";
import "./chunk-OC7D2HR4.js";
import "./chunk-IGMG7ERK.js";
import "./chunk-V47ZBW5W.js";
import "./chunk-HKYICNT2.js";
import "./chunk-VGUQMPM6.js";
import "./chunk-CTU2XDPA.js";
import "./chunk-KKH7HGO3.js";
import "./chunk-SUBGY5CE.js";
import "./chunk-Z3NV3VCK.js";
import "./chunk-7VNQKVOW.js";
import "./chunk-PNVXSHN2.js";
import "./chunk-3DVL3O3F.js";
import "./chunk-RN66FJAW.js";
import "./chunk-QYSQ6XPQ.js";
import "./chunk-2RIHQI4N.js";
import "./chunk-VLKWWBLY.js";
import "./chunk-NXGNMEHZ.js";
import "./chunk-TWYDW6LU.js";
import {
  d as d2
} from "./chunk-PVHAAI32.js";
import "./chunk-MLATPUII.js";
import "./chunk-NVFQGMP6.js";
import "./chunk-P2IB5HBH.js";
import "./chunk-XX37BOHH.js";
import "./chunk-5CRXWQ3Y.js";
import "./chunk-4RFCLPAF.js";
import "./chunk-U3JQIAF6.js";
import "./chunk-BHQS42D6.js";
import "./chunk-4ISVH4NS.js";
import "./chunk-NIWINVGG.js";
import "./chunk-DOENTAA7.js";
import "./chunk-CVI4GL5M.js";
import "./chunk-CGSFKZP2.js";
import "./chunk-EPAKCM4A.js";
import "./chunk-WPERPIJF.js";
import "./chunk-RXJCBLN2.js";
import "./chunk-EFVIMN4N.js";
import "./chunk-XKMN3LJN.js";
import "./chunk-2U5JYYSG.js";
import "./chunk-AFULL6KA.js";
import "./chunk-URFLFG2R.js";
import "./chunk-BVHISPUT.js";
import "./chunk-QMGMKWTA.js";
import "./chunk-2EGO74J5.js";
import "./chunk-4SUK447J.js";
import "./chunk-2X7T37AY.js";
import "./chunk-XQH2QDB2.js";
import {
  d
} from "./chunk-6Q7GN2CW.js";
import "./chunk-MYUZZ3A3.js";
import "./chunk-2IGXKE5P.js";
import "./chunk-JFI4ESYU.js";
import "./chunk-4X2UADDH.js";
import "./chunk-ZICJB3ML.js";
import "./chunk-AVBIV2K3.js";
import "./chunk-4NJWIUZG.js";
import "./chunk-F3NUC2RS.js";
import "./chunk-LE3YW4Y3.js";
import "./chunk-TA32QX7Z.js";
import "./chunk-NYLL2YZF.js";
import "./chunk-P3GRQ2CH.js";
import "./chunk-NYLBGE62.js";
import "./chunk-LPNAPHOF.js";
import "./chunk-QCBTLG25.js";
import "./chunk-SUZN3TAH.js";
import "./chunk-K5RYAJV4.js";
import "./chunk-XGYM66XX.js";
import "./chunk-JOOGZSAP.js";
import "./chunk-J6GHQIZ2.js";
import "./chunk-VEUN2EF3.js";
import "./chunk-W6D3ECTZ.js";
import "./chunk-QXDQJEIU.js";
import "./chunk-MGMVRMXQ.js";
import "./chunk-SEUZ3J6J.js";
import {
  i
} from "./chunk-BWTCR2DR.js";
import "./chunk-SMOTPOZ7.js";
import "./chunk-YVSEBNS4.js";
import "./chunk-Y2XCZQML.js";
import "./chunk-EZXLBRAS.js";
import "./chunk-7FJIOZSE.js";
import "./chunk-GNWAZIVF.js";
import "./chunk-2PK57UYA.js";
import "./chunk-3L2AYCZY.js";
import "./chunk-TSVUPARM.js";
import "./chunk-VUJERGGB.js";
import "./chunk-NTI2OCVI.js";
import "./chunk-ZCHZRNUG.js";
import "./chunk-G6REFQRQ.js";
import "./chunk-2TEGRXBS.js";
import "./chunk-6Y2LNRVP.js";
import "./chunk-JVEZN6WF.js";
import "./chunk-E2RPCJOE.js";
import "./chunk-NHJGPXZH.js";
import "./chunk-JS7R723S.js";
import "./chunk-RCLWOQNR.js";
import "./chunk-DOTSJZHK.js";
import "./chunk-UCO66LNK.js";
import "./chunk-5YRJ4YFE.js";
import "./chunk-RD2BBQYN.js";
import {
  b
} from "./chunk-SEG3PRUR.js";
import "./chunk-B6VE32RA.js";
import "./chunk-AIYFWM42.js";
import "./chunk-2M53HYNY.js";
import "./chunk-6YWQXXBX.js";
import "./chunk-Q7TEBZSN.js";
import "./chunk-FG3XOAFD.js";
import "./chunk-GN5RE63N.js";
import "./chunk-2WXAPZBK.js";
import "./chunk-E2I7HYXQ.js";
import "./chunk-P5H5PJSC.js";
import "./chunk-WTNHDCCU.js";
import "./chunk-7O7KFKCG.js";
import "./chunk-TVTRNT6K.js";
import "./chunk-CRH37WFF.js";
import "./chunk-YFGQMO6E.js";
import "./chunk-HAF6QJ32.js";
import "./chunk-H77COA2S.js";
import "./chunk-7LJCT7EA.js";
import "./chunk-MV5XBD6C.js";
import "./chunk-GRW2QIBT.js";
import "./chunk-R2PAF6JT.js";
import "./chunk-6WE7SNQY.js";
import "./chunk-L6CCOEVE.js";
import {
  a,
  s2 as s
} from "./chunk-PKLD5YJF.js";
import "./chunk-XKQWTZMW.js";
import "./chunk-A4OFG7JM.js";

// node_modules/@arcgis/core/arcade.js
var p = null;
function f(e, t2, a2, n3 = {}) {
  const o = t2.elementType, s2 = "value", c = "array" === o.type ? [{ name: s2, type: o.type, elementType: o.elementType }] : "dictionary" === o.type ? [{ name: s2, type: o.type, properties: o.properties }] : [{ name: s2, type: o.type }];
  return new t(e.map((e2) => {
    const t3 = {};
    return b2(t3, c, { [s2]: e2 }, a2, n3), t3[s2];
  }));
}
function m2(e, t2, r = {}) {
  const a2 = e instanceof d2 ? new Xe({ source: e.features, geometryType: e.geometryType, fields: e.fields, spatialReference: e.spatialReference }) : e;
  return t2.constructFeatureSet(a2, r.spatialReference, null, true, r.lruCache, r.interceptor);
}
function y(e, t2, r = {}) {
  const { spatialReference: a2, interceptor: n3, lruCache: o } = r;
  return "string" == typeof e ? t2.createFeatureSetCollectionFromService(e, a2, o, n3) : t2.createFeatureSetCollectionFromMap(e, a2, o, n3);
}
function d3(e, t2, r, a2 = {}) {
  const n3 = {};
  return b2(n3, t2.properties, e, r, a2), new p.Dictionary(n3);
}
function b2(e, r, a2, n3, c = {}) {
  const i2 = {};
  for (const t2 of Object.keys(a2)) i2[t2.toLowerCase()] = a2[t2];
  for (const l of r) {
    const r2 = l.name.toLowerCase();
    if (c.variablesPreProcessed) e[r2] = i2[r2];
    else switch (l.type) {
      case "array": {
        const t2 = i2[r2];
        e[r2] = null == t2 ? null : f(t2, l, n3, c);
        break;
      }
      case "feature": {
        const t2 = i2[r2];
        e[r2] = null == t2 ? null : p.Feature.createFromGraphic(t2, c == null ? void 0 : c.timeZone);
        break;
      }
      case "featureSet": {
        const t2 = i2[r2];
        e[r2] = null == t2 ? null : n3 ? m2(t2, n3, c) : null;
        break;
      }
      case "featureSetCollection": {
        const t2 = i2[r2];
        e[r2] = null == t2 ? null : n3 ? y(t2, n3, c) : null;
        break;
      }
      case "dictionary": {
        const t2 = i2[r2];
        e[r2] = null == t2 ? null : d3(t2, l, n3, c);
        break;
      }
      case "date": {
        const a3 = i2[r2];
        e[r2] = a3 ? a3 instanceof m ? a3 : (c == null ? void 0 : c.timeZone) ? m.dateJSAndZoneToArcadeDate(a3, c == null ? void 0 : c.timeZone) : m.dateJSToArcadeDate(a3) : null;
        break;
      }
      case "dateOnly": {
        const t2 = i2[r2];
        e[r2] = t2 ? t2 instanceof n ? t2 : n.fromReader(t2) : null;
        break;
      }
      case "time": {
        const t2 = i2[r2];
        e[r2] = t2 ? t2 instanceof n2 ? t2 : n2.fromReader(t2) : null;
        break;
      }
      case "knowledgeGraph":
      case "geometry":
      case "boolean":
      case "text":
      case "number":
        e[r2] = i2[r2];
    }
  }
}
function v(e, t2) {
  for (const r of e) t2.push(r), "dictionary" === r.type && v(r.properties, t2);
  return t2;
}
function S(e, t2, r, a2, n3) {
  const { spatialReference: o, interceptor: s2, lruCache: c, console: l, abortSignal: u, timeZone: p2, services: f2 = { portal: b.getDefault() } } = r, m3 = { vars: {}, spatialReference: o, interceptor: s2, timeZone: p2, lrucache: c, useAsync: n3, services: f2, console: l, abortSignal: u };
  return t2 ? (b2(m3.vars, e.variables, t2, a2, r), m3) : m3;
}
function g(t2, r) {
  switch (r.getArcadeType(t2)) {
    case "number":
    case "text":
    case "boolean":
    case "point":
    case "polygon":
    case "polyline":
    case "multipoint":
    case "extent":
      return t2;
    case "date":
      return t2.toJSDate();
    case "time":
    case "dateOnly":
      return t2.toString();
    case "feature": {
      const r2 = (t2.type, t2), a2 = "geometry" in r2 ? r2.geometry() : null, n3 = "readAttributes" in r2 ? r2.readAttributes() : r2.attributes;
      return new d({ geometry: a2, attributes: n3 });
    }
    case "dictionary": {
      const e = t2, a2 = e.attributes, n3 = {};
      for (const t3 of Object.keys(a2)) n3[t3] = g(e.field(t3), r);
      return n3;
    }
    case "array":
      return ("toArray" in t2 ? t2.toArray() : t2).map((e) => g(e, r));
  }
  return t2;
}
var w = { variables: [{ name: "$feature", type: "feature" }, { name: "$layer", type: "featureSet" }, { name: "$datastore", type: "featureSetCollection" }, { name: "$map", type: "featureSetCollection" }, { name: "$userInput", type: "geometry" }, { name: "$graph", type: "knowledgeGraph" }] };
var $ = { variables: [{ name: "$feature", type: "feature" }, { name: "$aggregatedFeatures", type: "featureSet" }] };
var h = /* @__PURE__ */ new Map([["aggregate-field", { variables: [{ name: "$feature", type: "feature" }] }], ["form-constraint", { variables: [{ name: "$feature", type: "feature" }] }], ["feature-z", { variables: [{ name: "$feature", type: "feature" }] }], ["field-calculation", { variables: [{ name: "$feature", type: "feature" }, { name: "$datastore", type: "featureSetCollection" }] }], ["form-calculation", { variables: [{ name: "$feature", type: "feature" }, { name: "$originalFeature", type: "feature" }, { name: "$layer", type: "featureSet" }, { name: "$featureSet", type: "featureSet" }, { name: "$datastore", type: "featureSetCollection" }, { name: "$map", type: "featureSetCollection" }, { name: "$editContext", type: "dictionary", properties: [{ name: "editType", type: "text" }] }] }], ["labeling", { variables: [{ name: "$feature", type: "feature" }] }], ["popup", w], ["popup-element", w], ["feature-reduction-popup", $], ["feature-reduction-popup-element", $], ["visualization", { variables: [{ name: "$feature", type: "feature" }, { name: "$view", type: "dictionary", properties: [{ name: "scale", type: "number" }] }] }]]);
function C(e) {
  const t2 = h.get(e);
  if (!t2) {
    const t3 = Array.from(h.keys()).map((e2) => `'${e2}'`).join(", ");
    throw new s("createArcadeProfile:invalid-profile-name", `Invalid profile name '${e}'. You must specify one of the following values: ${t3}`);
  }
  return a(t2);
}
async function A(e, t2, r = {}) {
  p || (p = await i());
  const { arcade: n3, arcadeUtils: o } = p, { loadScriptDependencies: s2, referencesMember: c, scriptIsAsync: i2 } = n3, l = v(t2.variables, []), f2 = l.filter((e2) => "featureSet" === e2.type || "featureSetCollection" === e2.type).map((e2) => e2.name.toLowerCase()), m3 = n3.parseScript(e, f2);
  if (!m3) throw new s("arcade:invalid-script", "Unable to create SyntaxTree");
  const y2 = o.extractFieldNames(m3), d4 = n3.scriptTouchesGeometry(m3), b3 = l.map((e2) => e2.name.toLowerCase()).filter((e2) => c(m3, e2)), w2 = i2(m3, f2);
  await s2(m3, w2, f2);
  const $2 = { vars: {}, spatialReference: null, useAsync: w2 };
  for (const a2 of b3) $2.vars[a2] = "any";
  const { lruCache: h2 } = r, C2 = n3.compileScript(m3, $2), A2 = n3.featureSetUtils(), { services: j } = r;
  return { execute: (e2, r2 = {}) => {
    if (w2) throw new s("arcade:invalid-execution-mode", "Cannot execute the script in synchronous mode");
    const n4 = C2(S(t2, e2, { lruCache: h2, ...r2 }, A2, w2));
    return r2.rawOutput ? n4 : g(n4, o);
  }, executeAsync: async (e2, r2 = {}) => {
    const a2 = await C2(S(t2, e2, { lruCache: h2, services: j, ...r2 }, A2, w2));
    return r2.rawOutput ? a2 : g(a2, o);
  }, isAsync: w2, variablesUsed: b3, fieldsUsed: y2, geometryUsed: d4, syntaxTree: m3 };
}
export {
  A as createArcadeExecutor,
  C as createArcadeProfile
};
//# sourceMappingURL=arcade-E5OVUKYF.js.map
