import {
  n as n3
} from "./chunk-PAS43ZQC.js";
import {
  d
} from "./chunk-G7VPHLH2.js";
import {
  n as n2
} from "./chunk-V6VYGXU4.js";
import {
  n
} from "./chunk-SMOTPOZ7.js";
import {
  b2 as b,
  m
} from "./chunk-H77COA2S.js";
import {
  a4 as a
} from "./chunk-7LJCT7EA.js";
import {
  r
} from "./chunk-MV5XBD6C.js";

// node_modules/@arcgis/core/layers/support/ExportImageParameters.js
var n4 = { visible: "visibleSublayers", definitionExpression: "layerDefs", labelingInfo: "hasDynamicLayers", labelsVisible: "hasDynamicLayers", opacity: "hasDynamicLayers", minScale: "visibleSublayers", maxScale: "visibleSublayers", renderer: "hasDynamicLayers", source: "hasDynamicLayers" };
var y = class extends b {
  constructor(e) {
    super(e), this.floors = null, this.scale = 0;
  }
  destroy() {
    this.layer = null;
  }
  get dynamicLayers() {
    if (!this.hasDynamicLayers) return null;
    const e = this.visibleSublayers.map((e2) => {
      const r2 = n3(this.floors, e2);
      return e2.toExportImageJSON(r2);
    });
    return e.length ? JSON.stringify(e) : null;
  }
  get hasDynamicLayers() {
    return this.layer && n2(this.visibleSublayers, this.layer.serviceSublayers, this.layer.gdbVersion);
  }
  set layer(e) {
    this._get("layer") !== e && (this._set("layer", e), this.removeHandles("layer"), e && this.addHandles([e.allSublayers.on("change", () => this.notifyChange("visibleSublayers")), e.on("sublayer-update", (e2) => this.notifyChange(n4[e2.propertyName]))], "layer"));
  }
  get layers() {
    const e = this.visibleSublayers;
    return e ? e.length ? "show:" + e.map((e2) => e2.id).join(",") : "show:-1" : null;
  }
  get layerDefs() {
    var _a;
    const e = !!((_a = this.floors) == null ? void 0 : _a.length), r2 = this.visibleSublayers.filter((r3) => null != r3.definitionExpression || e && null != r3.floorInfo);
    return r2.length ? JSON.stringify(r2.reduce((e2, r3) => {
      const t = n3(this.floors, r3), i = n(t, r3.definitionExpression);
      return null != i && (e2[r3.id] = i), e2;
    }, {})) : null;
  }
  get version() {
    this.commitProperty("layers"), this.commitProperty("layerDefs"), this.commitProperty("dynamicLayers");
    const e = this.layer;
    return e && (e.commitProperty("dpi"), e.commitProperty("imageFormat"), e.commitProperty("imageTransparency"), e.commitProperty("gdbVersion")), (this._get("version") || 0) + 1;
  }
  get visibleSublayers() {
    const e = [];
    if (!this.layer) return e;
    const r2 = this.layer.sublayers, s = this.scale, t = (r3) => {
      r3.visible && (0 === s || d(s, r3.minScale, r3.maxScale)) && (r3.sublayers ? r3.sublayers.forEach(t) : e.unshift(r3));
    };
    r2 && r2.forEach(t);
    const i = this._get("visibleSublayers");
    return !i || i.length !== e.length || i.some((r3, s2) => e[s2] !== r3) ? e : i;
  }
  toJSON() {
    const e = this.layer;
    let r2 = { dpi: e.dpi, format: e.imageFormat, transparent: e.imageTransparency, gdbVersion: e.gdbVersion || null };
    return this.hasDynamicLayers && this.dynamicLayers ? r2.dynamicLayers = this.dynamicLayers : r2 = { ...r2, layers: this.layers, layerDefs: this.layerDefs }, r2;
  }
};
r([m({ readOnly: true })], y.prototype, "dynamicLayers", null), r([m()], y.prototype, "floors", void 0), r([m({ readOnly: true })], y.prototype, "hasDynamicLayers", null), r([m()], y.prototype, "layer", null), r([m({ readOnly: true })], y.prototype, "layers", null), r([m({ readOnly: true })], y.prototype, "layerDefs", null), r([m({ type: Number })], y.prototype, "scale", void 0), r([m({ readOnly: true })], y.prototype, "version", null), r([m({ readOnly: true })], y.prototype, "visibleSublayers", null), y = r([a("esri.layers.support.ExportImageParameters")], y);

export {
  y
};
//# sourceMappingURL=chunk-HCUIGCK7.js.map
