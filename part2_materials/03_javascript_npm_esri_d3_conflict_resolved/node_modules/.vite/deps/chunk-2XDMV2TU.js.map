{
  "version": 3,
  "sources": ["../../@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/shaders/OverlayShader.js", "../../@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/overlay/OverlayTechnique.js", "../../@arcgis/core/views/2d/engine/webgl/OverlayContainer.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{_ as t,a as o}from\"../../../../../../../chunks/tslib.es6.js\";import{location as e,uniform as r,GraphShaderModule as p,VertexInput as i,UniformGroup as s,FragmentOutput as n,input as d,FragmentInput as a}from\"../../GraphShaderModule.js\";import{Float as l,dot as v,Vec3 as c,Vec2 as y,Vec4 as u,texture2D as f,Mat3 as g,Sampler2D as m}from\"../../graph/glsl.js\";class x extends i{}t([e(0,y)],x.prototype,\"pos\",void 0),t([e(1,y)],x.prototype,\"uv\",void 0);class h extends a{}class w extends s{}t([r(g)],w.prototype,\"dvs\",void 0);class S extends s{}t([r(y)],S.prototype,\"perspective\",void 0),t([r(y)],S.prototype,\"texSize\",void 0),t([r(l)],S.prototype,\"wrapAroundShift\",void 0),t([r(l)],S.prototype,\"opacity\",void 0),t([r(m)],S.prototype,\"texture\",void 0);class j extends p{vertex(t){const o=t.uv.divide(this.config.texSize),e=new l(1).add(v(o,this.config.perspective)),r=new c(t.pos.add(new y(this.config.wrapAroundShift,0)),1),p=this.transform.dvs.multiply(r);return{uv:o,glPosition:new u(p.xy.multiply(e),0,e)}}fragment(t){const o=f(this.config.texture,t.uv).multiply(this.config.opacity),e=new n;return e.glFragColor=o,e}}t([r(w)],j.prototype,\"transform\",void 0),t([r(S)],j.prototype,\"config\",void 0),t([o(0,d(x))],j.prototype,\"vertex\",null),t([o(0,d(h))],j.prototype,\"fragment\",null);export{j as OverlayShader};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{destroyMaybe as e}from\"../../../../../../../core/maybe.js\";import{Mesh as t}from\"../../../meshing/Mesh.js\";import{simplePipelineState as s}from\"../../utils.js\";import{Technique as i}from\"../Technique.js\";import{TechniqueType as o}from\"../TechniqueType.js\";import{OverlayShader as r}from\"../shaders/OverlayShader.js\";import{CompareFunction as n,StencilOperation as a,DataType as p,PrimitiveType as h}from\"../../../../../../webgl/enums.js\";class u extends i{constructor(){super(...arguments),this.type=o.Overlay,this._mesh=null,this.shaders={overlay:new r}}render(e,t){const{context:i,painter:o}=e,r=this._getMesh(e,t);o.setPipelineState(s);const{isWrapAround:p,wrapAroundShift:h}=t.config,u={...t.config,wrapAroundShift:0},m={shader:this.shaders.overlay,uniforms:{transform:t.transform,config:u},defines:null,optionalAttributes:null,useComputeBuffer:!1};o.setPipelineState({...s,stencil:{write:!1,test:{compare:n.EQUAL,op:{fail:a.KEEP,zFail:a.KEEP,zPass:a.REPLACE},ref:0,mask:255}}}),o.submitDrawMeshUntyped(i,m,r),p&&(u.wrapAroundShift=h,o.submitDrawMeshUntyped(i,m,r))}shutdown(){e(this._mesh)}_getMesh(e,s){const{context:i}=e;if(this._mesh){const e=this._mesh.vertexBuffers.get(\"positions\");if(!e)throw new Error(\"Buffer not found\");e.setData(s.position)}else{const e=null!=s.index?s.index.length:s.position.length/2;this._mesh=new t(i,{vertex:{positions:s.position,uvs:s.tex},index:null!=s.index?{index:s.index}:void 0,groups:[{attributes:[{name:\"pos\",count:2,type:p.FLOAT,location:0,vertex:\"positions\",stride:8,offset:0},{name:\"tex\",count:2,type:p.UNSIGNED_SHORT,location:1,vertex:\"uvs\",stride:4,offset:0}],index:null!=s.index?\"index\":void 0,primitive:h.TRIANGLE_STRIP}],parts:[{group:0,start:0,count:e}]})}return this._mesh}}export{u as OverlayTechnique};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{toRadian as t}from\"../../../../core/libs/gl-matrix-2/math/common.js\";import{identity as e,multiply as r,translate as o,scale as i,rotate as s}from\"../../../../core/libs/gl-matrix-2/math/mat3.js\";import{create as a}from\"../../../../core/libs/gl-matrix-2/factories/mat3f32.js\";import{fromValues as n}from\"../../../../core/libs/gl-matrix-2/factories/vec2f32.js\";import{fromValues as l}from\"../../../../core/libs/gl-matrix-2/factories/vec3f32.js\";import{normalizeMapX as c}from\"../../../../geometry/support/normalizeUtils.js\";import{getInfo as h}from\"../../../../geometry/support/spatialReferenceUtils.js\";import{getWorldWidth as m}from\"../../viewpointUtils.js\";import{WGLDrawPhase as d}from\"./enums.js\";import p from\"./WGLContainer.js\";import{OverlayTechnique as f}from\"./shaderGraph/techniques/overlay/OverlayTechnique.js\";class u extends p{constructor(){super(...arguments),this._viewStateId=-1,this._dvsMat3=a(),this._overlayTechnique=new f}get dvsMat3(){return this._dvsMat3}beforeRender(t){this._updateMatrices(t),this._updateOverlays(t,this.children);for(const e of this.children)e.beforeRender(t)}doRender(t){if(t.drawPhase!==d.MAP||!this.visible)return;super.doRender(t);const e=this._overlayTechnique;for(const r of this.children)r.draw(t,e)}onDetach(){this._overlayTechnique.shutdown()}_updateMatrices(a){const{state:h}=a,{id:m,size:d,pixelRatio:p,resolution:f,rotation:u,viewpoint:v,displayMat3:_}=h;if(this._viewStateId===m)return;const M=t(u),g=p*d[0],y=p*d[1];this._localOrigin=v.targetGeometry.clone();const{x:w,y:x}=this._localOrigin,b=c(w,h.spatialReference);this._localOrigin.x=b,this._localOrigin.y=x;const j=f*g,O=f*y,R=e(this._dvsMat3);r(R,R,_),o(R,R,n(g/2,y/2)),i(R,R,l(g/j,-y/O,1)),s(R,R,-M),this._viewStateId=m}_updateOverlays(e,r){const{state:o}=e,{rotation:i,spatialReference:s,worldScreenWidth:a,size:n,viewpoint:l}=o,c=this._localOrigin;let d,p=0;const f=h(s);if(f&&s.isWrappable){const e=n[0],r=n[1],c=t(i),h=Math.abs(Math.cos(c)),u=Math.abs(Math.sin(c)),v=Math.round(e*h+r*u),[_,M]=f.valid,g=m(s),{x:y,y:w}=l.targetGeometry,x=[y,w],b=[0,0];o.toScreen(b,x);const j=[0,0];let O;O=v>a?.5*a:.5*v;const R=Math.floor((y+.5*g)/g),q=_+R*g,S=M+R*g,G=[b[0]+O,0];o.toMap(j,G),j[0]>S&&(p=g),G[0]=b[0]-O,o.toMap(j,G),j[0]<q&&(p=-g),d={worldWidth:g,xBounds:[_,M]}}for(const t of r)t.updateDrawCoords(c,p,s,d)}}export{u as default};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAI8W,IAAM,IAAN,cAAgBA,GAAC;AAAC;AAAC,EAAE,CAACC,GAAE,GAAEC,EAAC,CAAC,GAAE,EAAE,WAAU,OAAM,MAAM,GAAE,EAAE,CAACD,GAAE,GAAEC,EAAC,CAAC,GAAE,EAAE,WAAU,MAAK,MAAM;AAAE,IAAMD,KAAN,cAAgB,EAAC;AAAC;AAAC,IAAME,KAAN,cAAgB,EAAC;AAAC;AAAC,EAAE,CAAC,EAAE,EAAC,CAAC,GAAEA,GAAE,WAAU,OAAM,MAAM;AAAE,IAAMC,KAAN,cAAgB,EAAC;AAAC;AAAC,EAAE,CAAC,EAAEF,EAAC,CAAC,GAAEE,GAAE,WAAU,eAAc,MAAM,GAAE,EAAE,CAAC,EAAEF,EAAC,CAAC,GAAEE,GAAE,WAAU,WAAU,MAAM,GAAE,EAAE,CAAC,EAAE,CAAC,CAAC,GAAEA,GAAE,WAAU,mBAAkB,MAAM,GAAE,EAAE,CAAC,EAAE,CAAC,CAAC,GAAEA,GAAE,WAAU,WAAU,MAAM,GAAE,EAAE,CAAC,EAAE,CAAC,CAAC,GAAEA,GAAE,WAAU,WAAU,MAAM;AAAE,IAAMC,KAAN,cAAgBA,GAAC;AAAA,EAAC,OAAOC,IAAE;AAAC,UAAMC,KAAED,GAAE,GAAG,OAAO,KAAK,OAAO,OAAO,GAAEE,KAAE,IAAI,EAAE,CAAC,EAAE,IAAI,GAAED,IAAE,KAAK,OAAO,WAAW,CAAC,GAAEE,KAAE,IAAI,EAAEH,GAAE,IAAI,IAAI,IAAIJ,GAAE,KAAK,OAAO,iBAAgB,CAAC,CAAC,GAAE,CAAC,GAAE,IAAE,KAAK,UAAU,IAAI,SAASO,EAAC;AAAE,WAAM,EAAC,IAAGF,IAAE,YAAW,IAAI,EAAE,EAAE,GAAG,SAASC,EAAC,GAAE,GAAEA,EAAC,EAAC;AAAA,EAAC;AAAA,EAAC,SAASF,IAAE;AAAC,UAAMC,KAAE,GAAE,KAAK,OAAO,SAAQD,GAAE,EAAE,EAAE,SAAS,KAAK,OAAO,OAAO,GAAEE,KAAE,IAAI;AAAE,WAAOA,GAAE,cAAYD,IAAEC;AAAA,EAAC;AAAC;AAAC,EAAE,CAAC,EAAEL,EAAC,CAAC,GAAEE,GAAE,WAAU,aAAY,MAAM,GAAE,EAAE,CAAC,EAAED,EAAC,CAAC,GAAEC,GAAE,WAAU,UAAS,MAAM,GAAE,EAAE,CAAC,EAAE,GAAE,EAAE,CAAC,CAAC,CAAC,GAAEA,GAAE,WAAU,UAAS,IAAI,GAAE,EAAE,CAAC,EAAE,GAAE,EAAEJ,EAAC,CAAC,CAAC,GAAEI,GAAE,WAAU,YAAW,IAAI;;;ACA30B,IAAMK,KAAN,cAAgBC,GAAC;AAAA,EAAC,cAAa;AAAC,UAAM,GAAG,SAAS,GAAE,KAAK,OAAKC,GAAE,SAAQ,KAAK,QAAM,MAAK,KAAK,UAAQ,EAAC,SAAQ,IAAIC,KAAC;AAAA,EAAC;AAAA,EAAC,OAAOD,IAAED,IAAE;AAAC,UAAK,EAAC,SAAQG,IAAE,SAAQC,GAAC,IAAEH,IAAEI,KAAE,KAAK,SAASJ,IAAED,EAAC;AAAE,IAAAI,GAAE,iBAAiBJ,EAAC;AAAE,UAAK,EAAC,cAAa,GAAE,iBAAgBM,GAAC,IAAEN,GAAE,QAAOD,KAAE,EAAC,GAAGC,GAAE,QAAO,iBAAgB,EAAC,GAAEO,KAAE,EAAC,QAAO,KAAK,QAAQ,SAAQ,UAAS,EAAC,WAAUP,GAAE,WAAU,QAAOD,GAAC,GAAE,SAAQ,MAAK,oBAAmB,MAAK,kBAAiB,MAAE;AAAE,IAAAK,GAAE,iBAAiB,EAAC,GAAGJ,IAAE,SAAQ,EAAC,OAAM,OAAG,MAAK,EAAC,SAAQ,EAAE,OAAM,IAAG,EAAC,MAAK,EAAE,MAAK,OAAM,EAAE,MAAK,OAAM,EAAE,QAAO,GAAE,KAAI,GAAE,MAAK,IAAG,EAAC,EAAC,CAAC,GAAEI,GAAE,sBAAsBD,IAAEI,IAAEF,EAAC,GAAE,MAAIN,GAAE,kBAAgBO,IAAEF,GAAE,sBAAsBD,IAAEI,IAAEF,EAAC;AAAA,EAAE;AAAA,EAAC,WAAU;AAAC,MAAE,KAAK,KAAK;AAAA,EAAC;AAAA,EAAC,SAASJ,IAAE,GAAE;AAAC,UAAK,EAAC,SAAQE,GAAC,IAAEF;AAAE,QAAG,KAAK,OAAM;AAAC,YAAMA,KAAE,KAAK,MAAM,cAAc,IAAI,WAAW;AAAE,UAAG,CAACA,GAAE,OAAM,IAAI,MAAM,kBAAkB;AAAE,MAAAA,GAAE,QAAQ,EAAE,QAAQ;AAAA,IAAC,OAAK;AAAC,YAAMA,KAAE,QAAM,EAAE,QAAM,EAAE,MAAM,SAAO,EAAE,SAAS,SAAO;AAAE,WAAK,QAAM,IAAIE,GAAEA,IAAE,EAAC,QAAO,EAAC,WAAU,EAAE,UAAS,KAAI,EAAE,IAAG,GAAE,OAAM,QAAM,EAAE,QAAM,EAAC,OAAM,EAAE,MAAK,IAAE,QAAO,QAAO,CAAC,EAAC,YAAW,CAAC,EAAC,MAAK,OAAM,OAAM,GAAE,MAAK,EAAE,OAAM,UAAS,GAAE,QAAO,aAAY,QAAO,GAAE,QAAO,EAAC,GAAE,EAAC,MAAK,OAAM,OAAM,GAAE,MAAK,EAAE,gBAAe,UAAS,GAAE,QAAO,OAAM,QAAO,GAAE,QAAO,EAAC,CAAC,GAAE,OAAM,QAAM,EAAE,QAAM,UAAQ,QAAO,WAAU,EAAE,eAAc,CAAC,GAAE,OAAM,CAAC,EAAC,OAAM,GAAE,OAAM,GAAE,OAAMF,GAAC,CAAC,EAAC,CAAC;AAAA,IAAC;AAAC,WAAO,KAAK;AAAA,EAAK;AAAC;;;ACA54B,IAAMO,KAAN,cAAgB,EAAC;AAAA,EAAC,cAAa;AAAC,UAAM,GAAG,SAAS,GAAE,KAAK,eAAa,IAAG,KAAK,WAASC,GAAE,GAAE,KAAK,oBAAkB,IAAID;AAAA,EAAC;AAAA,EAAC,IAAI,UAAS;AAAC,WAAO,KAAK;AAAA,EAAQ;AAAA,EAAC,aAAaE,IAAE;AAAC,SAAK,gBAAgBA,EAAC,GAAE,KAAK,gBAAgBA,IAAE,KAAK,QAAQ;AAAE,eAAUD,MAAK,KAAK,SAAS,CAAAA,GAAE,aAAaC,EAAC;AAAA,EAAC;AAAA,EAAC,SAASA,IAAE;AAAC,QAAGA,GAAE,cAAYC,GAAE,OAAK,CAAC,KAAK,QAAQ;AAAO,UAAM,SAASD,EAAC;AAAE,UAAMD,KAAE,KAAK;AAAkB,eAAUG,MAAK,KAAK,SAAS,CAAAA,GAAE,KAAKF,IAAED,EAAC;AAAA,EAAC;AAAA,EAAC,WAAU;AAAC,SAAK,kBAAkB,SAAS;AAAA,EAAC;AAAA,EAAC,gBAAgB,GAAE;AAAC,UAAK,EAAC,OAAMI,GAAC,IAAE,GAAE,EAAC,IAAGC,IAAE,MAAKC,IAAE,YAAW,GAAE,YAAWC,IAAE,UAASR,IAAE,WAAUS,IAAE,aAAY,EAAC,IAAEJ;AAAE,QAAG,KAAK,iBAAeC,GAAE;AAAO,UAAMI,KAAEV,GAAEA,EAAC,GAAEW,KAAE,IAAEJ,GAAE,CAAC,GAAE,IAAE,IAAEA,GAAE,CAAC;AAAE,SAAK,eAAaE,GAAE,eAAe,MAAM;AAAE,UAAK,EAAC,GAAEG,IAAE,GAAEC,GAAC,IAAE,KAAK,cAAa,IAAE,EAAED,IAAEP,GAAE,gBAAgB;AAAE,SAAK,aAAa,IAAE,GAAE,KAAK,aAAa,IAAEQ;AAAE,UAAMC,KAAEN,KAAEG,IAAEI,KAAEP,KAAE,GAAE,IAAE,EAAE,KAAK,QAAQ;AAAE,MAAE,GAAE,GAAE,CAAC,GAAE,EAAE,GAAE,GAAE,EAAEG,KAAE,GAAE,IAAE,CAAC,CAAC,GAAE,EAAE,GAAE,GAAEP,GAAEO,KAAEG,IAAE,CAAC,IAAEC,IAAE,CAAC,CAAC,GAAE,EAAE,GAAE,GAAE,CAACL,EAAC,GAAE,KAAK,eAAaJ;AAAA,EAAC;AAAA,EAAC,gBAAgBL,IAAEG,IAAE;AAAC,UAAK,EAAC,OAAMY,GAAC,IAAEf,IAAE,EAAC,UAASgB,IAAE,kBAAiB,GAAE,kBAAiB,GAAE,MAAKC,IAAE,WAAU,EAAC,IAAEF,IAAE,IAAE,KAAK;AAAa,QAAIT,IAAE,IAAE;AAAE,UAAMC,KAAE,EAAE,CAAC;AAAE,QAAGA,MAAG,EAAE,aAAY;AAAC,YAAMP,KAAEiB,GAAE,CAAC,GAAEd,KAAEc,GAAE,CAAC,GAAEC,KAAEnB,GAAEiB,EAAC,GAAEZ,KAAE,KAAK,IAAI,KAAK,IAAIc,EAAC,CAAC,GAAEnB,KAAE,KAAK,IAAI,KAAK,IAAImB,EAAC,CAAC,GAAEV,KAAE,KAAK,MAAMR,KAAEI,KAAED,KAAEJ,EAAC,GAAE,CAAC,GAAEU,EAAC,IAAEF,GAAE,OAAMG,KAAE,GAAE,CAAC,GAAE,EAAC,GAAE,GAAE,GAAEC,GAAC,IAAE,EAAE,gBAAeC,KAAE,CAAC,GAAED,EAAC,GAAE,IAAE,CAAC,GAAE,CAAC;AAAE,MAAAI,GAAE,SAAS,GAAEH,EAAC;AAAE,YAAMC,KAAE,CAAC,GAAE,CAAC;AAAE,UAAIC;AAAE,MAAAA,KAAEN,KAAE,IAAE,MAAG,IAAE,MAAGA;AAAE,YAAM,IAAE,KAAK,OAAO,IAAE,MAAGE,MAAGA,EAAC,GAAE,IAAE,IAAE,IAAEA,IAAES,KAAEV,KAAE,IAAEC,IAAEU,KAAE,CAAC,EAAE,CAAC,IAAEN,IAAE,CAAC;AAAE,MAAAC,GAAE,MAAMF,IAAEO,EAAC,GAAEP,GAAE,CAAC,IAAEM,OAAI,IAAET,KAAGU,GAAE,CAAC,IAAE,EAAE,CAAC,IAAEN,IAAEC,GAAE,MAAMF,IAAEO,EAAC,GAAEP,GAAE,CAAC,IAAE,MAAI,IAAE,CAACH,KAAGJ,KAAE,EAAC,YAAWI,IAAE,SAAQ,CAAC,GAAED,EAAC,EAAC;AAAA,IAAC;AAAC,eAAUR,MAAKE,GAAE,CAAAF,GAAE,iBAAiB,GAAE,GAAE,GAAEK,EAAC;AAAA,EAAC;AAAC;",
  "names": ["I", "h", "C", "w", "S", "j", "t", "o", "e", "r", "u", "t", "e", "j", "i", "o", "r", "h", "m", "u", "e", "t", "E", "r", "h", "m", "d", "f", "v", "M", "g", "w", "x", "j", "O", "o", "i", "n", "c", "S", "G"]
}
