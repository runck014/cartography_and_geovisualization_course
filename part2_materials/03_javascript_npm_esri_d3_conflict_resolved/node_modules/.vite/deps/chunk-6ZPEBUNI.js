import {
  S
} from "./chunk-6ALL3HYU.js";
import {
  i
} from "./chunk-ZGL6Q57M.js";
import {
  r as r2,
  t3 as t
} from "./chunk-KDQTUT24.js";
import {
  E,
  e
} from "./chunk-F3ZOBTPK.js";
import {
  u
} from "./chunk-ZCHZRNUG.js";
import {
  a4 as a
} from "./chunk-7LJCT7EA.js";
import {
  r
} from "./chunk-MV5XBD6C.js";

// node_modules/@arcgis/core/views/2d/engine/BitmapTile.js
var r3 = class extends r2 {
  constructor(e3, s, r5, i2, a2, n3, o2 = null) {
    super(e3, s, r5, i2, a2, n3), this.bitmap = new S(o2), this.bitmap.coordScale = [a2, n3], this.bitmap.once("isReady", () => this.ready());
  }
  destroy() {
    super.destroy(), this.bitmap.destroy();
  }
  beforeRender(e3) {
    this.bitmap.beforeRender(e3), super.beforeRender(e3);
  }
  afterRender(e3) {
    this.bitmap.afterRender(e3), super.afterRender(e3);
  }
  set stencilRef(e3) {
    this.bitmap.stencilRef = e3;
  }
  get stencilRef() {
    return this.bitmap.stencilRef;
  }
  _createTransforms() {
    return { displayViewScreenMat3: e(), tileMat3: e() };
  }
  setTransform(e3) {
    super.setTransform(e3), this.bitmap.transforms.displayViewScreenMat3 = this.transforms.displayViewScreenMat3;
  }
  onAttach() {
    this.bitmap.stage = this.stage;
  }
  onDetach() {
    this.bitmap && (this.bitmap.stage = null);
  }
};

// node_modules/@arcgis/core/views/2d/engine/BitmapTileContainer.js
var n = class extends i {
  get requiresDedicatedFBO() {
    return this.children.some((e3) => "additive" === e3.bitmap.blendFunction);
  }
  createTile(r5) {
    const t3 = this.tileInfoView.getTileBounds(u(), r5), s = this.tileInfoView.getTileResolution(r5.level), [n3, o2] = this.tileInfoView.tileInfo.size;
    return new r3(r5, s, t3[0], t3[3], n3, o2);
  }
  prepareRenderPasses(e3) {
    const i2 = e3.registerRenderPass({ name: "bitmap (tile)", brushes: [t.bitmap], target: () => this.children.map((e4) => e4.bitmap), drawPhase: E.MAP });
    return [...super.prepareRenderPasses(e3), i2];
  }
  doRender(e3) {
    this.visible && e3.drawPhase === E.MAP && super.doRender(e3);
  }
};

// node_modules/@arcgis/core/views/2d/layers/BitmapTileLayerView2D.js
var r4 = (r5) => {
  let s = class extends r5 {
    attach() {
      this.view.timeline.record(`${this.layer.title} (BitmapTileLayer) Attach`), this._bitmapView = new n(this._tileInfoView), this.container.addChild(this._bitmapView);
    }
    detach() {
      var _a;
      this.container.removeChild(this._bitmapView), (_a = this._bitmapView) == null ? void 0 : _a.removeAllChildren(), this._bitmapView = null;
    }
  };
  return s = r([a("esri.views.2d.layers.BitmapTileLayerView2D")], s), s;
};

// node_modules/@arcgis/core/views/2d/layers/support/imageUtils.js
function e2(e3) {
  return e3 instanceof HTMLImageElement ? e3.naturalWidth : e3.width;
}
function t2(e3) {
  return e3 instanceof HTMLImageElement ? e3.naturalHeight : e3.height;
}
function n2(n3, l, r5, u2) {
  if (r5.level === u2.level) return l;
  const i2 = n3.tileInfo.size, a2 = n3.getTileResolution(r5.level), c = n3.getTileResolution(u2.level);
  let g = n3.getLODInfoAt(u2.level);
  const h = g.getXForColumn(u2.col), d = g.getYForRow(u2.row);
  g = n3.getLODInfoAt(r5.level);
  const f = g.getXForColumn(r5.col), s = g.getYForRow(r5.row), m = e2(l) / i2[0], v = t2(l) / i2[1], w = Math.round(m * ((h - f) / a2)), I = Math.round(v * (-(d - s) / a2)), M = Math.round(m * i2[0] * (c / a2)), F = Math.round(v * i2[1] * (c / a2)), L = o(i2);
  return L.getContext("2d").drawImage(l, w, I, M, F, 0, 0, i2[0], i2[1]), L;
}
function o(e3) {
  const t3 = document.createElement("canvas");
  return [t3.width, t3.height] = e3, t3;
}

export {
  r4 as r,
  n2 as n,
  o
};
//# sourceMappingURL=chunk-6ZPEBUNI.js.map
