{
  "version": 3,
  "sources": ["../../@arcgis/core/symbols/cim/CIMSymbolRasterizer.js", "../../@arcgis/core/symbols/support/previewCIMSymbol.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport e from\"./CIMResourceManager.js\";import{Transformation as t,CanvasDrawHelper as i}from\"./CIMSymbolDrawHelper.js\";import{CIMSymbolHelper as r}from\"./CIMSymbolHelper.js\";import{OverrideHelper as a}from\"./OverrideHelper.js\";import{mapCIMSymbolToGeometryType as s}from\"./utils.js\";const n=96/72;class h{constructor(t){this._spatialReference=t,this._imageDataCanvas=null,this._cimResourceManager=new e}get _canvas(){return this._imageDataCanvas||(this._imageDataCanvas=document.createElement(\"canvas\")),this._imageDataCanvas}get resourceManager(){return this._cimResourceManager}async rasterizeCIMSymbolAsync(e,t,i,n,h,l,c,m,g){if(!e)return null;const{data:y}=e;if(!y||\"CIMSymbolReference\"!==y.type||!y.symbol)return null;const{symbol:d}=y;l||(l=s(d));const u=await a.resolveSymbolOverrides(y,t,this._spatialReference,h,l,c,m),w=this._cimResourceManager,p=[];r.fetchResources(u,w,p),r.fetchFonts(u,w,p),p.length>0&&await Promise.all(p);const{width:b,height:f}=i,M=o(l,b,f,n),C=r.getEnvelope(u,M,w);if(!C)return null;C.x===1/0&&(C.x=b+2),C.y===1/0&&(C.y=-f/2),C.width===-1/0&&(C.width=b),C.height===-1/0&&(C.height=f);let R=1,v=0,x=0;switch(d.type){case\"CIMPointSymbol\":case\"CIMTextSymbol\":{let e=1;C.width>b&&(e=b/C.width);let t=1;C.height>f&&(t=f/C.height),\"preview\"===n&&(C.width<b&&(e=b/C.width),C.height<f&&(t=f/C.height)),R=Math.min(e,t),v=C.x+C.width/2,x=C.y+C.height/2}break;case\"CIMLineSymbol\":{(g||C.height>f)&&(R=f/C.height),x=C.y+C.height/2;const e=C.x*R+b/2,t=(C.x+C.width)*R+b/2,{paths:i}=M;i[0][0][0]-=e/R,i[0][2][0]-=(t-b)/R}break;case\"CIMPolygonSymbol\":{v=C.x+C.width/2,x=C.y+C.height/2;const e=C.x*R+b/2,t=(C.x+C.width)*R+b/2,i=C.y*R+f/2,r=(C.y+C.height)*R+f/2,{rings:a}=M;e<0&&(a[0][0][0]-=e,a[0][3][0]-=e,a[0][4][0]-=e),i<0&&(a[0][0][1]+=i,a[0][1][1]+=i,a[0][4][1]+=i),t>b&&(a[0][1][0]-=t-b,a[0][2][0]-=t-b),r>f&&(a[0][2][1]+=r-f,a[0][3][1]+=r-f)}}const I={type:\"cim\",data:{type:\"CIMSymbolReference\",symbol:u}};return this.rasterize(I,b,f,v,x,R,l,1,M)}rasterize(e,r,a,h,l,c,m,g=0,y=null){const{data:d}=e;if(!d||\"CIMSymbolReference\"!==d.type||!d.symbol)return null;const{symbol:u}=d,w=this._canvas,p=(window.devicePixelRatio||1)*n;w.width=r*p,w.height=a*p,m||(m=s(u)),y||(y=o(m,r,a,\"legend\")),w.width+=2*g,w.height+=2*g;const b=w.getContext(\"2d\",{willReadFrequently:!0}),f=t.createIdentity();f.translate(-h,-l),f.scale(c*p,-c*p),f.translate(r*p/2+g,a*p/2+g),b.clearRect(0,0,w.width,w.height);return new i(b,this._cimResourceManager,f,!0).drawSymbol(u,y),b.getImageData(0,0,w.width,w.height)}}function o(e,t,i,r){const a=1,s=-t/2+a,n=t/2-a,h=i/2-a,o=-i/2+a;switch(e){case\"esriGeometryPoint\":return{x:0,y:0};case\"esriGeometryPolyline\":return{paths:[[[s,0],[0,0],[n,0]]]};default:return\"legend\"===r?{rings:[[[s,h],[n,0],[n,o],[s,o],[s,h]]]}:{rings:[[[s,h],[n,h],[n,o],[s,o],[s,h]]]}}}export{h as CIMSymbolRasterizer};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport{px2pt as e,pt2px as t}from\"../../core/screenUtils.js\";import{CIMSymbolHelper as i}from\"../cim/CIMSymbolHelper.js\";import{CIMSymbolRasterizer as l}from\"../cim/CIMSymbolRasterizer.js\";import{OverrideHelper as r}from\"../cim/OverrideHelper.js\";import{mapCIMSymbolToGeometryType as n}from\"../cim/utils.js\";import{SymbolSizeDefaults as a}from\"./previewUtils.js\";import{renderSymbol as o}from\"./renderUtils.js\";const s=new l(null),c=e(a.size),m=e(a.maxSize),u=e(a.lineWidth),f=1;async function h(e,t,i){const l=t?.size;let r=null!=l&&\"object\"==typeof l&&\"width\"in l?l.width:l,n=null!=l&&\"object\"==typeof l&&\"height\"in l?l.height:l;if(null==r||null==n)if(\"esriGeometryPolygon\"===i)r=c,n=c;else{const l=await y(e,t,i);l&&(r=l.width,n=l.height),\"esriGeometryPolyline\"===i&&(r=u),r=null!=r&&isFinite(r)?Math.min(r,m):c,n=null!=n&&isFinite(n)?Math.max(Math.min(n,m),f):c}return\"legend\"===t.style&&\"esriGeometryPolyline\"===i&&(r=u),{width:r,height:n}}async function y(e,t,l){const{feature:n,fieldMap:a,viewParams:o}=t.cimOptions||t,c=await r.resolveSymbolOverrides(e.data,n,null,a,l,null,o);if(!c)return null;(e=e.clone()).data={type:\"CIMSymbolReference\",symbol:c},e.data.primitiveOverrides=void 0;const m=[];return i.fetchResources(c,s.resourceManager,m),i.fetchFonts(c,s.resourceManager,m),m.length>0&&await Promise.all(m),i.getEnvelope(c,null,s.resourceManager)}async function p(e,i={}){const{node:l,opacity:r,symbolConfig:a}=i,c=null!=a&&\"object\"==typeof a&&\"isSquareFill\"in a&&a.isSquareFill,m=i.cimOptions||i,u=m.geometryType||n(e?.data?.symbol),f=await h(e,i,u),{feature:y,fieldMap:p}=m,d=c||\"esriGeometryPolygon\"!==u?\"preview\":\"legend\",g=await s.rasterizeCIMSymbolAsync(e,y,f,d,p,u,null,m.viewParams,m.allowScalingUp);if(!g)return null;const{width:w,height:b}=g,v=document.createElement(\"canvas\");v.width=w,v.height=b;v.getContext(\"2d\").putImageData(g,0,0);const M=t(f.width),j=t(f.height),S=new Image(M,j);S.src=v.toDataURL(),S.ariaLabel=i.ariaLabel??null,S.alt=i.ariaLabel??\"\",null!=r&&(S.style.opacity=`${r}`);let C=S;if(null!=i.effectView){const e={shape:{type:\"image\",x:0,y:0,width:M,height:j,src:S.src},fill:null,stroke:null,offset:[0,0]};C=o([[e]],[M,j],{effectView:i.effectView,ariaLabel:i.ariaLabel})}return l&&C&&l.appendChild(C),C}export{p as previewCIMSymbol};\n"],
  "mappings": "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",
  "names": ["t", "e", "i", "n", "h", "l", "c", "m", "y", "u", "p", "f", "s", "o", "u", "h", "e", "t", "i", "l", "n", "y", "o", "c", "m", "f", "p"]
}
