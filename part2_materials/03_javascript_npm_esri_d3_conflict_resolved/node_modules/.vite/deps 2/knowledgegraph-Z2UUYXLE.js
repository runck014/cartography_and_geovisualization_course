import {
  l
} from "./chunk-LVWOO3MP.js";
import {
  t
} from "./chunk-X3MAK4EE.js";
import {
  N
} from "./chunk-3FC4BMWX.js";
import {
  $,
  Be,
  E,
  P,
  Q,
  Y,
  a,
  ae,
  de,
  ee,
  ie,
  ne,
  q,
  r,
  te,
  z
} from "./chunk-DP4BKMXB.js";
import "./chunk-ZFCZ2Q23.js";
import "./chunk-Q4J5AN2X.js";
import "./chunk-OJRG2YGM.js";
import {
  s as s2
} from "./chunk-2AAEPG7Z.js";
import {
  c,
  m,
  p,
  t as t2
} from "./chunk-GDUYVE2V.js";
import "./chunk-MBR7IVUG.js";
import {
  n as n2,
  p as p2
} from "./chunk-ANP4SJL6.js";
import "./chunk-EFVIMN4N.js";
import "./chunk-WGIZLWW7.js";
import "./chunk-PUOCGOJB.js";
import "./chunk-DBQLTBDH.js";
import "./chunk-AMH7OVBF.js";
import "./chunk-SUZN3TAH.js";
import "./chunk-LXJGKQ4D.js";
import "./chunk-M5RSIRGD.js";
import "./chunk-D2JPDRZZ.js";
import "./chunk-UYSPJCCV.js";
import "./chunk-5A4G4OVM.js";
import "./chunk-MGMVRMXQ.js";
import "./chunk-SW4DFX7N.js";
import "./chunk-2PK57UYA.js";
import "./chunk-F26LCWNQ.js";
import {
  K,
  W,
  _
} from "./chunk-H4N5QOMX.js";
import "./chunk-F2LC36UV.js";
import "./chunk-6Y2LNRVP.js";
import "./chunk-VNRDIGVF.js";
import "./chunk-QRJFHPMB.js";
import "./chunk-G6REFQRQ.js";
import "./chunk-Z2DWZ5IF.js";
import "./chunk-NHJGPXZH.js";
import "./chunk-JS7R723S.js";
import "./chunk-X6JBJVM2.js";
import "./chunk-Q7TEBZSN.js";
import {
  S
} from "./chunk-BMGF5ELJ.js";
import {
  b
} from "./chunk-JU6MEO4D.js";
import "./chunk-CY5MS6DC.js";
import "./chunk-C6FFJ4QS.js";
import "./chunk-Q4Q32WYV.js";
import {
  R,
  j,
  n
} from "./chunk-A3J7W53Y.js";
import "./chunk-HLF5XJSV.js";
import {
  g
} from "./chunk-L6D73M4D.js";
import "./chunk-P5H5PJSC.js";
import "./chunk-H6RIEXAG.js";
import "./chunk-Y6AYXNMP.js";
import "./chunk-6YWQXXBX.js";
import "./chunk-DRBJFCLQ.js";
import "./chunk-7O7KFKCG.js";
import "./chunk-E2X3OBBC.js";
import "./chunk-X7VTUWCX.js";
import "./chunk-QS62R4CH.js";
import "./chunk-VU6O6TFT.js";
import "./chunk-GD4XDYZL.js";
import "./chunk-33ECLFFF.js";
import "./chunk-MV5XBD6C.js";
import "./chunk-L6CCOEVE.js";
import "./chunk-GRW2QIBT.js";
import "./chunk-R2PAF6JT.js";
import "./chunk-6WE7SNQY.js";
import {
  s
} from "./chunk-PKLD5YJF.js";
import "./chunk-XKQWTZMW.js";
import "./chunk-A4OFG7JM.js";

// node_modules/@arcgis/core/arcade/functions/knowledgegraph.js
var F = null;
async function J(r2) {
  const t3 = s.geometryServiceUrl ?? "";
  if (!t3) {
    _() || await W();
    for (const e of r2) e.container[e.indexer] = K(e.container[e.indexer], g.WGS84);
    return;
  }
  const n3 = r2.map((e) => e.container[e.indexer]), o = new p2({ geometries: n3, outSpatialReference: g.WGS84 }), a2 = await n2(t3, o);
  for (let e = 0; e < a2.length; e++) {
    const t4 = r2[e];
    t4.container[t4.indexer] = a2[e];
  }
}
async function M(e, r2) {
  const t3 = new S({ portal: e, id: r2 });
  return await t3.load(), null === F && (F = await import("./knowledgeGraphService-Q5Z6OMGG.js")), await F.fetchKnowledgeGraph(t3.url);
}
function Q2(e, r2, t3, n3, o) {
  if (null === e) return null;
  if (P(e) || z(e)) return e;
  if (ee(e)) return e.toJSDate();
  if (ee(e)) return e.toJSDate();
  if (te(e)) return e.toStorageFormat();
  if (ne(e)) return e.toStorageString();
  if (Q(e)) {
    const a2 = {};
    for (const i of e.keys()) a2[i] = Q2(e.field(i), r2, t3, n3, o), a2[i] instanceof n && o.push({ container: a2, indexer: i });
    return a2;
  }
  if (E(e)) {
    const a2 = e.map((e2) => Q2(e2, r2, t3, n3, o));
    for (let e2 = 0; e2 < a2.length; e2++) a2[e2] instanceof n && o.push({ container: a2, indexer: e2 });
    return a2;
  }
  return q(e) ? e.spatialReference.isWGS84 ? e : e.spatialReference.isWebMercator && r2 ? j(e) : e : void 0;
}
function E2(e, r2) {
  if (!e) return e;
  if (e.spatialReference.isWGS84 && r2.spatialReference.isWebMercator) return R(e);
  if (e.spatialReference.equals(r2.spatialReference)) return e;
  throw new a(r2, r.WrongSpatialReference, null);
}
function K2(e, r2) {
  if (!e) return null;
  const t3 = {};
  for (const n3 in e) t3[n3] = V(e[n3], r2);
  return t3;
}
function V(e, r2) {
  return null === e ? null : E(e) ? e.map((e2) => V(e2, r2)) : e instanceof m ? { graphTypeName: e.typeName, id: e.id, graphType: "entity", properties: K2(e.properties, r2) } : e instanceof t2 ? { graphType: "object", properties: K2(e.properties, r2) } : e instanceof p ? { graphTypeName: e.typeName, id: e.id, graphType: "relationship", originId: e.originId ?? null, destinationId: e.destinationId ?? null, properties: K2(e.properties, r2) } : e instanceof c ? { graphType: "path", path: e.path ? e.path.map((e2) => V(e2, r2)) : null } : q(e) ? E2(e, r2) : P(e) || z(e) || ae(e) ? e : null;
}
function C(e) {
  "async" === e.mode && (e.functions.knowledgegraphbyportalitem = function(t3, p3) {
    return e.standardFunctionAsync(t3, p3, (e2, l2, c2) => {
      var _a, _b;
      if (ie(c2, 2, 2, t3, p3), null === c2[0]) throw new a(t3, r.PortalRequired, p3);
      if (c2[0] instanceof t) {
        const e3 = de(c2[1]);
        let r2;
        r2 = ((_a = t3.services) == null ? void 0 : _a.portal) ? t3.services.portal : b.getDefault();
        return M(l(c2[0], r2), e3);
      }
      if (false === P(c2[0])) throw new a(t3, r.InvalidParameter, p3);
      const f = de(c2[0]);
      return M(((_b = t3.services) == null ? void 0 : _b.portal) ?? b.getDefault(), f);
    });
  }, e.signatures.push({ name: "knowledgegraphbyportalitem", min: 2, max: 2 }), e.functions.querygraph = function(r2, i) {
    return e.standardFunctionAsync(r2, i, async (e2, u, m2) => {
      var _a;
      ie(m2, 2, 4, r2, i);
      const d = m2[0];
      if (!$(d)) throw new a(r2, r.InvalidParameter, i);
      const g2 = m2[1];
      if (!P(g2)) throw new a(r2, r.InvalidParameter, i);
      null === F && (F = await import("./knowledgeGraphService-Q5Z6OMGG.js"));
      let h = null;
      const w = Y(m2[2], null);
      if (!(w instanceof N || null === w)) throw new a(r2, r.InvalidParameter, i);
      if (w) {
        let e3 = [];
        h = Q2(w, true, false, r2, e3), e3 = e3.filter((e4) => !e4.container[e4.indexer].spatialReference.isWGS84), e3.length > 0 && await J(e3);
      }
      const y = new s2({ openCypherQuery: g2, bindParameters: h });
      (((_a = d == null ? void 0 : d.serviceDefinition) == null ? void 0 : _a.currentVersion) ?? 11.3) > 11.2 && (y.outputSpatialReference = r2.spatialReference);
      const j2 = (await F.executeQueryStreaming(d, y)).resultRowsStream.getReader(), S2 = [];
      try {
        for (; ; ) {
          const { done: e3, value: t3 } = await j2.read();
          if (e3) break;
          if (E(t3)) for (const n3 of t3) S2.push(V(n3, r2));
          else {
            const e4 = [];
            for (const n3 of t3) e4.push(V(t3[n3], r2));
            S2.push(e4);
          }
        }
      } catch (v) {
        throw v;
      }
      return N.convertJsonToArcade(S2, Be(r2), false, true);
    });
  }, e.signatures.push({ name: "querygraph", min: 2, max: 4 }));
}
export {
  C as registerFunctions
};
//# sourceMappingURL=knowledgegraph-Z2UUYXLE.js.map
