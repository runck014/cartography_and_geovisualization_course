/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.0.3 */
import{b as F}from"./BFDAS53F.js";import{a as I,b as v,c as u,d as z,f as q,h as E}from"./7SQTVACB.js";import{k as L}from"./DWSKOILM.js";import{a as N,b as H}from"./3YYHU67H.js";import{a as T,b as R}from"./6NJ2XB5D.js";import{a as g}from"./RIMAR2EG.js";import{a as G}from"./SYD5OQF5.js";import"./DFFLO6RQ.js";import{a as w}from"./MOOKY73S.js";import{a as U}from"./HHWADIGN.js";import{b as k}from"./SZONZQBZ.js";import{g as M,u as b}from"./SXYTJEOC.js";import{b as O}from"./H6E5FODU.js";import{a as D}from"./B4YIOD3M.js";import{D as $,J as P,e as x,f as d,v as p,w as y,x as h}from"./74XIV7EB.js";var m={container:"container",table:"table",scrim:"scrim",stack:"stack",tableContainer:"table-container",sticky:"sticky-pos",assistiveText:"assistive-text"},S={filterNoResults:"filter-no-results",filterActionsStart:"filter-actions-start",filterActionsEnd:"filter-actions-end"},B=x`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:block}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}.container{position:relative;background-color:var(--calcite-list-background-color, var(--calcite-color-foreground-1))}.table-container{box-sizing:border-box;display:flex;inline-size:100%;flex-direction:column;background-color:transparent}.table-container *{box-sizing:border-box}.table{inline-size:100%}.stack{--calcite-stack-padding-inline: 0;--calcite-stack-padding-block: 0}.sticky-pos{position:sticky;inset-block-start:0px;z-index:var(--calcite-z-index-sticky);background-color:var(--calcite-list-background-color, var(--calcite-color-foreground-1))}.assistive-text{position:absolute;inline-size:1px;block-size:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}:host([hidden]){display:none}[hidden]{display:none}`,K=`${v}, ${u}`,C=class extends y{constructor(){super(),this.dragSelector=u,this.focusableItems=[],this.handleSelector="calcite-sort-handle",this.listItems=[],this.listItemGroups=[],this.mutationObserver=w("mutation",()=>{this.willPerformFilter=!0,this.updateListItems()}),this.updateListItems=G(()=>{this.updateGroupItems();let{selectionAppearance:e,selectionMode:t,interactionMode:i,dragEnabled:l,el:s,filterEl:a,moveToItems:o,displayMode:r,scale:c}=this,f=Array.from(this.el.querySelectorAll(u));if(f.forEach(n=>{n.scale=c,n.selectionAppearance=e,n.selectionMode=t,n.interactionMode=i,n.closest(I)===s&&(n.moveToItems=o.filter(A=>A.element!==s&&!n.contains(A.element)),n.dragHandle=l,n.displayMode=r)}),this.parentListEl){this.setUpSorting();return}this.listItems=f,this.filterEnabled&&this.willPerformFilter&&(this.willPerformFilter=!1,this.dataForFilter=this.getItemData(),a&&(a.items=this.dataForFilter,this.filterAndUpdateData())),this.visibleItems=this.listItems.filter(n=>!n.closed&&!n.hidden),this.updateFilteredItems(),this.borderItems(),this.focusableItems=this.filteredItems.filter(n=>!n.disabled),this.setActiveListItem(),this.updateSelectedItems(),this.setUpSorting()},$.nextTick),this.visibleItems=[],this.willFilterEmit=!1,this.willPerformFilter=!1,this.dataForFilter=[],this.hasFilterActionsEnd=!1,this.hasFilterActionsStart=!1,this.hasFilterNoResults=!1,this.moveToItems=[],this.disabled=!1,this.dragEnabled=!1,this.filterEnabled=!1,this.filteredData=[],this.filteredItems=[],this.interactionMode="interactive",this.loading=!1,this.messages=U({blocking:!0}),this.displayMode="flat",this.scale="m",this.selectedItems=[],this.selectionAppearance="icon",this.selectionMode="none",this.calciteInternalListDefaultSlotChange=p({cancelable:!1}),this.calciteListChange=p({cancelable:!1}),this.calciteListDragEnd=p({cancelable:!1}),this.calciteListDragStart=p({cancelable:!1}),this.calciteListFilter=p({cancelable:!1}),this.calciteListOrderChange=p({cancelable:!1}),this.listen("calciteInternalListItemToggle",this.handleCalciteListItemToggle),this.listen("calciteInternalFocusPreviousItem",this.handleCalciteInternalFocusPreviousItem),this.listen("calciteInternalListItemActive",this.handleCalciteInternalListItemActive),this.listen("calciteListItemSelect",this.handleCalciteListItemSelect),this.listen("calciteInternalAssistiveTextChange",this.handleCalciteInternalAssistiveTextChange),this.listen("calciteSortHandleReorder",this.handleSortReorder),this.listen("calciteSortHandleMove",this.handleSortMove),this.listen("calciteInternalListItemSelect",this.handleCalciteInternalListItemSelect),this.listen("calciteInternalListItemSelectMultiple",this.handleCalciteInternalListItemSelectMultiple),this.listen("calciteInternalListItemChange",this.handleCalciteInternalListItemChange),this.listen("calciteInternalListItemGroupDefaultSlotChange",this.handleCalciteInternalListItemGroupDefaultSlotChange)}static{this.properties={assistiveText:16,dataForFilter:16,hasFilterActionsEnd:16,hasFilterActionsStart:16,hasFilterNoResults:16,moveToItems:16,hasActiveFilter:16,showNoResultsContainer:16,canPull:0,canPut:0,disabled:7,dragEnabled:7,filterEnabled:7,filterPredicate:0,filterLabel:3,filterPlaceholder:3,filterProps:0,filterText:3,filteredData:0,filteredItems:0,group:3,interactionMode:3,label:1,loading:7,messageOverrides:0,displayMode:3,numberingSystem:1,scale:3,selectedItems:0,selectionAppearance:3,selectionMode:3}}static{this.styles=B}get hasActiveFilter(){return this.filterEnabled&&this.filterText&&this.filteredItems.length!==this.visibleItems.length}get showNoResultsContainer(){return this.filterEnabled&&this.filterText&&this.hasFilterNoResults&&this.visibleItems.length&&!this.filteredItems.length}async setFocus(){return await O(this),this.filterEnabled?this.filterEl?.setFocus():this.focusableItems.find(e=>e.active)?.setFocus()}connectedCallback(){super.connectedCallback(),this.connectObserver(),this.willPerformFilter=!0,this.updateListItems(),this.setUpSorting(),this.setParentList(),this.setListItemGroups()}async load(){this.handleInteractionModeWarning()}willUpdate(e){(e.has("filterText")||e.has("filterProps")||e.has("filterPredicate"))&&this.performFilter(),(e.has("filterEnabled")&&(this.hasUpdated||this.filterEnabled!==!1)||e.has("group")||e.has("dragEnabled")&&(this.hasUpdated||this.dragEnabled!==!1)||e.has("selectionMode")&&(this.hasUpdated||this.selectionMode!=="none")||e.has("selectionAppearance")&&(this.hasUpdated||this.selectionAppearance!=="icon")||e.has("displayMode")&&this.hasUpdated||e.has("scale")&&this.hasUpdated||e.has("filterPredicate")&&this.hasUpdated)&&this.handleListItemChange()}updated(){T(this)}loaded(){}disconnectedCallback(){super.disconnectedCallback(),this.disconnectObserver(),H(this)}handleListItemChange(){this.willPerformFilter=!0,this.updateListItems()}handleCalciteListItemToggle(e){this.parentListEl||(e.stopPropagation(),this.borderItems())}handleCalciteInternalFocusPreviousItem(e){if(this.parentListEl)return;e.stopPropagation();let{focusableItems:t}=this,i=t.findIndex(l=>l.active)-1;t[i]&&this.focusRow(t[i])}handleCalciteInternalListItemActive(e){if(this.parentListEl)return;e.stopPropagation();let t=e.target,{listItems:i}=this;i.forEach(l=>{l.active=l===t})}handleCalciteListItemSelect(){this.parentListEl||this.updateSelectedItems(!0)}handleCalciteInternalAssistiveTextChange(e){this.assistiveText=e.detail.message,e.stopPropagation()}handleSortReorder(e){this.parentListEl||this.handleReorder(e)}handleSortMove(e){this.parentListEl||this.handleMove(e)}handleCalciteInternalListItemSelect(e){if(this.parentListEl)return;e.stopPropagation();let t=e.target,{listItems:i,selectionMode:l}=this;t.selected&&(l==="single"||l==="single-persist")&&i.forEach(s=>s.selected=s===t),this.updateSelectedItems()}handleCalciteInternalListItemSelectMultiple(e){if(this.parentListEl)return;e.stopPropagation();let{target:t,detail:i}=e,{focusableItems:l,lastSelectedInfo:s}=this,a=t;if(i.selectMultiple&&s){let o=l.indexOf(a),r=l.indexOf(s.selectedItem),c=Math.min(r,o),f=Math.max(r,o);l.slice(c,f+1).forEach(n=>n.selected=s.selected)}else this.lastSelectedInfo={selectedItem:a,selected:a.selected}}handleCalciteInternalListItemChange(e){this.parentListEl||(e.stopPropagation(),this.updateListItems())}handleCalciteInternalListItemGroupDefaultSlotChange(e){e.stopPropagation()}connectObserver(){this.mutationObserver?.observe(this.el,{childList:!0,subtree:!0})}disconnectObserver(){this.mutationObserver?.disconnect()}setUpSorting(){let{dragEnabled:e}=this;e&&N(this)}onGlobalDragStart(){this.disconnectObserver()}onGlobalDragEnd(){this.connectObserver()}onDragEnd(e){this.calciteListDragEnd.emit(e)}onDragMove({relatedEl:e}){e.open=!0}onDragStart(e){e.dragEl.sortHandleOpen=!1,this.calciteListDragStart.emit(e)}onDragSort(e){this.setParentList(),this.updateListItems(),this.calciteListOrderChange.emit(e)}setParentList(){this.parentListEl=this.el.parentElement?.closest(I)}handleDefaultSlotChange(e){q(e.target),this.parentListEl&&this.calciteInternalListDefaultSlotChange.emit()}setListItemGroups(){this.listItemGroups=Array.from(this.el.querySelectorAll(v))}handleFilterActionsStartSlotChange(e){this.hasFilterActionsStart=b(e)}handleFilterActionsEndSlotChange(e){this.hasFilterActionsEnd=b(e)}handleFilterNoResultsSlotChange(e){this.hasFilterNoResults=b(e)}setActiveListItem(){let{focusableItems:e}=this;e.some(t=>t.active)||e[0]&&(e[0].active=!0)}async updateSelectedItems(e=!1){await this.updateComplete,this.selectedItems=this.visibleItems.filter(t=>t.selected),e&&this.calciteListChange.emit()}filterElements({el:e,filteredItems:t,visibleParents:i}){let l=!i.has(e)&&!t.includes(e);e.filterHidden=l;let s=e.parentElement.closest(K);s&&(l||i.add(s),this.filterElements({el:s,filteredItems:t,visibleParents:i}))}allParentListItemsOpen(e){let t=e.parentElement?.closest(u);if(t){if(!t.open)return!1}else return!0;return this.allParentListItemsOpen(t)}borderItems(){let e=this.visibleItems.filter(t=>!t.filterHidden&&this.allParentListItemsOpen(t));e.forEach(t=>t.bordered=t!==e[e.length-1])}updateFilteredItems(){let{visibleItems:e,filteredData:t,filterText:i,filterPredicate:l}=this,s=e?.filter(r=>e.every(c=>c===r||!r.contains(c))),a=l?e.filter(l):i?t.map(r=>r.el):e||[],o=new WeakSet;s.forEach(r=>this.filterElements({el:r,filteredItems:a,visibleParents:o})),this.filteredItems=a,this.willFilterEmit&&(this.willFilterEmit=!1,this.calciteListFilter.emit())}updateFilteredData(){let{filterEl:e}=this;e&&(e.filteredItems&&(this.filteredData=e.filteredItems),this.updateListItems())}async filterAndUpdateData(){await this.filterEl?.filter(this.filterText),this.updateFilteredData()}get effectiveFilterProps(){return this.filterProps?this.filterProps.filter(e=>e!=="el"):["description","label","metadata","heading"]}performFilter(){let{filterEl:e,filterText:t,effectiveFilterProps:i}=this;e&&(e.value=t,e.filterProps=i,this.filterAndUpdateData())}setFilterEl(e){this.filterEl=e,this.performFilter()}handleFilterChange(e){e.stopPropagation();let{value:t}=e.currentTarget;this.filterText=t,this.willFilterEmit=!0,this.updateFilteredData()}getItemData(){return this.listItems.map(e=>({label:e.label,description:e.description,metadata:e.metadata,heading:this.getGroupHeading(e),el:e}))}getGroupHeading(e){return this.listItemGroups.filter(t=>t.contains(e)).map(t=>t.heading)}updateGroupItems(){let{el:e,group:t,scale:i}=this,l=M(e),s=t?Array.from(l.querySelectorAll(`${I}[group="${t}"]`)).filter(a=>!a.disabled&&a.dragEnabled):[];this.moveToItems=s.map(a=>({element:a,label:a.label??a.id,id:D()})),Array.from(this.el.querySelectorAll(v)).forEach(a=>{a.scale=i})}focusRow(e){let{focusableItems:t}=this;e&&(t.forEach(i=>i.active=i===e),e.setFocus())}isNavigable(e){let t=e.parentElement?.closest(u);return t?t.open&&this.isNavigable(t):!0}handleListKeydown(e){if(e.defaultPrevented||this.parentListEl)return;let{key:t}=e,i=this.focusableItems.filter(s=>this.isNavigable(s)),l=i.findIndex(s=>s.active);if(t==="ArrowDown"){e.preventDefault();let s=e.target===this.filterEl?0:l+1;i[s]&&this.focusRow(i[s])}else if(t==="ArrowUp"){if(e.preventDefault(),l===0&&this.filterEnabled){this.filterEl?.setFocus();return}let s=l-1;i[s]&&this.focusRow(i[s])}else if(t==="Home"){e.preventDefault();let s=i[0];s&&this.focusRow(s)}else if(t==="End"){e.preventDefault();let s=i[i.length-1];s&&this.focusRow(s)}}handleInteractionModeWarning(){this.interactionMode==="static"&&this.selectionMode!=="none"&&this.selectionAppearance==="border"&&console.warn('selection-appearance="border" requires interaction-mode="interactive"')}handleMove(e){let{moveTo:t}=e.detail,i=e.target,l=i?.parentElement,s=t.element,a=Array.from(l.children).filter(E).indexOf(i);if(!l)return;i.sortHandleOpen=!1,this.disconnectObserver(),s.prepend(i),z(i);let o=Array.from(s.children).filter(E).indexOf(i);this.updateListItems(),this.connectObserver(),this.calciteListOrderChange.emit({dragEl:i,fromEl:l,toEl:s,newIndex:o,oldIndex:a})}handleReorder(e){let{reorder:t}=e.detail,i=e.target,l=i?.parentElement;if(!l)return;i.sortHandleOpen=!1;let s=Array.from(l.children).filter(E),a=s.length-1,o=s.indexOf(i),r=o;switch(t){case"top":r=0;break;case"bottom":r=a;break;case"up":r=o===0?0:o-1;break;case"down":r=o===a?a:o+1;break}this.disconnectObserver();let c=t==="up"||t==="top"?s[r]:s[r].nextSibling;l.insertBefore(i,c),this.updateListItems(),this.connectObserver(),this.calciteListOrderChange.emit({dragEl:i,fromEl:l,toEl:l,newIndex:r,oldIndex:o})}render(){let{loading:e,label:t,disabled:i,dataForFilter:l,filterEnabled:s,filterPlaceholder:a,filterText:o,filterLabel:r,hasFilterActionsStart:c,hasFilterActionsEnd:f,effectiveFilterProps:n}=this;return R({disabled:this.disabled,children:d`<div class=${h(m.container)}>${this.dragEnabled?d`<span aria-live=assertive class=${h(m.assistiveText)}>${this.assistiveText}</span>`:null}${this.renderItemAriaLive()}${e?d`<calcite-scrim class=${h(m.scrim)} .loading=${e}></calcite-scrim>`:null}<div .ariaBusy=${e} .ariaLabel=${t||""} class=${h(m.table)} @keydown=${this.handleListKeydown} role=treegrid>${s||c||f?d`<div class=${h(m.sticky)} role=rowgroup><div role=row><div role=columnheader><calcite-stack class=${h(m.stack)}><slot name=${S.filterActionsStart} @slotchange=${this.handleFilterActionsStartSlotChange} slot=${F.actionsStart}></slot><calcite-filter .ariaLabel=${a} .disabled=${i} .filterProps=${n} .items=${l} .label=${r} @calciteFilterChange=${this.handleFilterChange} .placeholder=${a} .scale=${this.scale} .value=${o} ${k(this.setFilterEl)}></calcite-filter><slot name=${S.filterActionsEnd} @slotchange=${this.handleFilterActionsEndSlotChange} slot=${F.actionsEnd}></slot></calcite-stack></div></div></div>`:null}<div class=${h(m.tableContainer)} role=rowgroup><slot @slotchange=${this.handleDefaultSlotChange}></slot></div></div><div aria-live=polite data-test-id=no-results-container .hidden=${!this.showNoResultsContainer}><slot name=${S.filterNoResults} @slotchange=${this.handleFilterNoResultsSlotChange}></slot></div></div>`})}renderItemAriaLive(){let{messages:e,filteredItems:t,parentListEl:i,messages:{_lang:l},numberingSystem:s}=this;return L.numberFormatOptions={locale:l,numberingSystem:s},i?null:d`<div aria-live=polite class=${h(m.assistiveText)}>${this.hasActiveFilter?g("aria-filter-enabled",d`<div>${e.filterEnabled}</div>`):null}${g("aria-item-count",d`<div>${e.total.replace("{count}",L.localize(t.length.toString()))}</div>`)}${t.length?g("aria-item-list",d`<ol>${t.map(a=>d`<li>${a.label}</li>`)}</ol>`):null}</div>`}};P("calcite-list",C);export{C as List};
