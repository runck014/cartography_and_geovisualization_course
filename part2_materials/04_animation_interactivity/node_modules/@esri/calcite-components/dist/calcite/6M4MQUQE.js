/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.0.3 */
import{a as T,b as $}from"./3YYHU67H.js";import{a as C,b as y}from"./6NJ2XB5D.js";import{a as G}from"./SYD5OQF5.js";import{a as x}from"./MOOKY73S.js";import{g as O,n as I}from"./SXYTJEOC.js";import{b as S}from"./H6E5FODU.js";import{a as B}from"./B4YIOD3M.js";import{D as k,J as E,e as v,f as d,v as h,w as f,x as n}from"./74XIV7EB.js";function m(c){return c.tagName==="CALCITE-BLOCK"}var p={container:"container",groupContainer:"group-container",scrim:"scrim",assistiveText:"assistive-text"},u="calcite-block-group",b="calcite-block",w=v`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:block}.container{position:relative}.assistive-text{position:absolute;inline-size:1px;block-size:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}:host([hidden]){display:none}[hidden]{display:none}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}`;function A(c){let e=c.assignedElements({flatten:!0}).filter(t=>t.matches(b));e.forEach(t=>{t.setPosition=e.indexOf(t)+1,t.setSize=e.length})}var g=class extends f{constructor(){super(),this.dragSelector=b,this.handleSelector="calcite-sort-handle",this.mutationObserver=x("mutation",()=>{this.updateBlockItems()}),this.updateBlockItems=G(()=>{this.updateGroupItems();let{dragEnabled:e,el:t,moveToItems:a}=this;Array.from(this.el.querySelectorAll(b)).forEach(i=>{i.closest(u)===t&&(i.moveToItems=a.filter(s=>s.element!==t&&!i.contains(s.element)),i.dragHandle=e)}),this.setUpSorting()},k.nextTick),this.moveToItems=[],this.disabled=!1,this.dragEnabled=!1,this.loading=!1,this.calciteBlockGroupDragEnd=h({cancelable:!1}),this.calciteBlockGroupDragStart=h({cancelable:!1}),this.calciteBlockGroupOrderChange=h({cancelable:!1}),this.listen("calciteInternalAssistiveTextChange",this.handleCalciteInternalAssistiveTextChange),this.listen("calciteSortHandleReorder",this.handleSortReorder),this.listen("calciteSortHandleMove",this.handleSortMove)}static{this.properties={assistiveText:16,moveToItems:16,canPull:0,canPut:0,disabled:7,dragEnabled:7,group:3,label:1,loading:7}}static{this.styles=w}async setFocus(){await S(this),I(this.el)}connectedCallback(){super.connectedCallback(),this.connectObserver(),this.updateBlockItems(),this.setUpSorting(),this.setParentBlockGroup()}willUpdate(e){(e.has("group")||e.has("dragEnabled")&&(this.hasUpdated||this.dragEnabled!==!1))&&this.updateBlockItems()}updated(){C(this)}disconnectedCallback(){super.disconnectedCallback(),this.disconnectObserver(),$(this)}updateGroupItems(){let{el:e,group:t}=this,a=O(e),i=t?Array.from(a.querySelectorAll(`${u}[group="${t}"]`)).filter(s=>!s.disabled&&s.dragEnabled):[];this.moveToItems=i.map(s=>({element:s,label:s.label??s.id,id:B()}))}handleCalciteInternalAssistiveTextChange(e){this.assistiveText=e.detail.message,e.stopPropagation()}handleSortReorder(e){this.parentBlockGroupEl||this.handleReorder(e)}handleSortMove(e){this.parentBlockGroupEl||this.handleMove(e)}connectObserver(){this.mutationObserver?.observe(this.el,{childList:!0,subtree:!0})}disconnectObserver(){this.mutationObserver?.disconnect()}setUpSorting(){let{dragEnabled:e}=this;e&&T(this)}onGlobalDragStart(){this.disconnectObserver()}onGlobalDragEnd(){this.connectObserver()}onDragEnd(e){this.calciteBlockGroupDragEnd.emit(e)}onDragStart(e){e.dragEl.sortHandleOpen=!1,this.calciteBlockGroupDragStart.emit(e)}onDragSort(e){this.setParentBlockGroup(),this.updateBlockItems(),this.calciteBlockGroupOrderChange.emit(e)}setParentBlockGroup(){this.parentBlockGroupEl=this.el.parentElement?.closest(u)}handleDefaultSlotChange(e){A(e.target)}handleMove(e){let{moveTo:t}=e.detail,a=e.target,i=a?.parentElement,s=t.element,l=Array.from(i.children).filter(m).indexOf(a);if(!i)return;a.sortHandleOpen=!1,this.disconnectObserver(),s.prepend(a);let r=Array.from(s.children).filter(m).indexOf(a);this.updateBlockItems(),this.connectObserver(),this.calciteBlockGroupOrderChange.emit({dragEl:a,fromEl:i,toEl:s,newIndex:r,oldIndex:l})}handleReorder(e){let{reorder:t}=e.detail,a=e.target,i=a?.parentElement;if(!i)return;a.sortHandleOpen=!1;let s=Array.from(i.children).filter(m),l=s.length-1,r=s.indexOf(a),o=r;switch(t){case"top":o=0;break;case"bottom":o=l;break;case"up":o=r===0?0:r-1;break;case"down":o=r===l?l:r+1;break}this.disconnectObserver();let D=t==="up"||t==="top"?s[o]:s[o].nextSibling;i.insertBefore(a,D),this.updateBlockItems(),this.connectObserver(),this.calciteBlockGroupOrderChange.emit({dragEl:a,fromEl:i,toEl:i,newIndex:o,oldIndex:r})}render(){let{loading:e,label:t}=this;return y({disabled:this.disabled,children:d`<div class=${n(p.container)}>${this.dragEnabled?d`<span aria-live=assertive class=${n(p.assistiveText)}>${this.assistiveText}</span>`:null}${e?d`<calcite-scrim class=${n(p.scrim)} .loading=${e}></calcite-scrim>`:null}<div .ariaBusy=${e} .ariaLabel=${t||""} class=${n(p.groupContainer)} role=group><slot @slotchange=${this.handleDefaultSlotChange}></slot></div></div>`})}};E("calcite-block-group",g);export{g as BlockGroup};
