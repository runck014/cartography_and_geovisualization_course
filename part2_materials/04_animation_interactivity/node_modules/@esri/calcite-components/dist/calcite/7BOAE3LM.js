/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.0.3 */
import{l as G}from"./DWSKOILM.js";import{a as C}from"./LDPDJTKP.js";import{c as W,e as j,f as A,h as H}from"./OEWDESOU.js";import{c as N,d as q}from"./7XDJ54GY.js";import{a as k,b as U}from"./6NJ2XB5D.js";import{a as F}from"./RIMAR2EG.js";import"./DFFLO6RQ.js";import{a as V}from"./HHWADIGN.js";import{b as R}from"./SZONZQBZ.js";import"./SXYTJEOC.js";import{b as _}from"./H6E5FODU.js";import"./B4YIOD3M.js";import{B as S,J as M,e as D,f as g,j as T,v as b,w as E,x as L}from"./74XIV7EB.js";var ee={offset:"offset"},te=60;function x(o){return o.replace(":15",".25").replace(":30",".5").replace(":45",".75").replace("\u2212","-")}function oe(o,e){let t=w(o,"en-US",e).replace("GMT","");return t===""?0:Number(x(t))*te}function ie(){return new Date().getTimezoneOffset()*-1}function se(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}async function ae(o){if(o==="offset")return t=>t;let{normalize:e}=await import("./4KGTT6I3.js");return e}async function ne(o,e,t,i,l){if(t==="name"){let{groupByName:a}=await import("./2ADYSLPZ.js");return(await a()).map(({label:n})=>({label:n,value:n,metadata:{filterValue:n}})).filter(n=>!!n).sort()}let u=l==="user"?o:l==="utc"?"fr":"en-GB",d=i.getTime();if(t==="region"){let[{groupByRegion:a},{getCountry:n,global:m}]=await Promise.all([import("./B45JROQX.js"),import("./PRPWC5NA.js")]);return(await a()).map(({label:s,tzs:c})=>(c.sort((r,h)=>{let v=I(r,e),y=I(h,e),p="Etc/GMT";if(r.startsWith(p)&&h.startsWith(p)){let f=r.substring(p.length),P=h.substring(p.length),Y=f===""?0:parseInt(f);return(P===""?0:parseInt(P))-Y}return v.localeCompare(y)}),{label:$(e,s),items:c.map(r=>{let h=x(w(r,u,d)),v=I(r,e),y=s===m?`${I(m,e)} Etc`:J(r),p=n(r),f=$(e,p);return{label:v,value:r,metadata:{country:f===v?void 0:f,filterValue:y,offset:h}}})})).sort((s,c)=>s.label===m?-1:c.label===m?1:s.label.localeCompare(c.label))}let[{groupByOffset:Z},{DateEngine:Q}]=await Promise.all([import("./GGSSFQEY.js"),import("./WOM5JCSF.js")]),z=await Z({dateEngine:new Q,groupDateRange:1,startDate:new Date(d).toISOString()}),X=new Intl.ListFormat(o,{style:"long",type:"conjunction"}),B=["Factory","Etc/UTC"];return z.forEach(a=>{let n=[],m=0;a.tzs.forEach((s,c)=>{B.includes(s)&&m++,n[c]=m}),a.tzs=a.tzs.filter(s=>!B.includes(s)),a.labelTzIdx=a.labelTzIdx.map(s=>s-n[s]).filter(s=>s>=0&&s<a.tzs.length)}),z.map(({labelTzIdx:a,tzs:n})=>{let m=n[0],s=x(w(m,u,d)),c=oe(m,d),r=a.map(h=>I(n[h],e));return{label:me(e,s,X.format(r)),value:c,metadata:{filterValue:n.map(h=>J(h))}}}).filter(a=>!!a).sort((a,n)=>a.value-n.value)}function I(o,e){return e[o]||re(o)}function le(o,e,t){return t.timeZoneRegionLabel.replace("{city}",o).replace("{country}",$(t,e))}function $(o,e){return o[e]||e}function re(o){return o.split("/").pop()}function J(o){return o.replace(/_/g," ")}function me(o,e,t){return o.timeZoneLabel.replace("{offset}",e).replace("{cities}",t)}function w(o,e,t=Date.now()){return o==="Factory"&&(o="Etc/GMT"),G(e,{timeZone:o,timeZoneName:"shortOffset"}).formatToParts(t).find(({type:i})=>i==="timeZoneName").value}function ce(o){return o.items!==void 0}function he(o){return ce(o[0])?o.flatMap(e=>e.items):o}function K(o,e,t){return t==null?null:he(o).find(i=>i[e]==t)}var de=D`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:block}.offset{white-space:nowrap}:host([hidden]){display:none}[hidden]{display:none}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}::slotted(input[slot=hidden-form-input]){margin:0!important;opacity:0!important;outline:none!important;padding:0!important;position:absolute!important;inset:0!important;transform:none!important;-webkit-appearance:none!important;z-index:-1!important}`,O=class extends E{constructor(){super(...arguments),this.clearable=!1,this.disabled=!1,this.maxItems=0,this.messages=V({blocking:!0}),this.mode="offset",this.offsetStyle="user",this.open=!1,this.overlayPositioning="absolute",this.readOnly=!1,this.required=!1,this.scale="m",this.status="idle",this.validity={valid:!1,badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valueMissing:!1},this.calciteInputTimeZoneBeforeClose=b({cancelable:!1}),this.calciteInputTimeZoneBeforeOpen=b({cancelable:!1}),this.calciteInputTimeZoneChange=b({cancelable:!1}),this.calciteInputTimeZoneClose=b({cancelable:!1}),this.calciteInputTimeZoneOpen=b({cancelable:!1})}static{this.properties={clearable:7,disabled:7,form:3,maxItems:11,messageOverrides:0,mode:3,name:3,offsetStyle:3,open:7,overlayPositioning:3,readOnly:7,referenceDate:1,required:7,scale:3,status:3,validationIcon:[3,{converter:S}],validationMessage:1,validity:0,value:1}}static{this.shadowRootOptions={mode:"open",delegatesFocus:!0}}static{this.styles=de}get value(){return this._value}set value(e){this._value=e}async setFocus(){await _(this),await this.comboboxEl.setFocus()}connectedCallback(){super.connectedCallback(),W(this),N(this)}async load(){this.normalizer=await ae(this.mode),await this.updateTimeZoneItems();let e=this.value,t=this.normalizeValue(e);this.value=t||(e===""?t:void 0),this.updateTimeZoneSelection();let i=this.selectedTimeZoneItem?`${this.selectedTimeZoneItem.value}`:"";A(this,i),this.value=i}willUpdate(e){e.has("value")&&this.hasUpdated&&this.handleValueChange(this.value,e.get("value")),(e.has("messages")||e.has("mode")&&(this.hasUpdated||this.mode!=="offset")||e.has("referenceDate"))&&this.handleTimeZoneItemPropsChange(),e.has("open")&&(this.hasUpdated||this.open!==!1)&&this.openChanged()}updated(){k(this)}loaded(){this.overrideSelectedLabelForRegion(this.open),this.openChanged()}disconnectedCallback(){super.disconnectedCallback(),j(this),q(this)}async handleTimeZoneItemPropsChange(){!this.timeZoneItems||!this.hasUpdated||(await this.updateTimeZoneItems(),this.updateTimeZoneSelection())}openChanged(){this.comboboxEl&&(this.comboboxEl.open=this.open)}async handleValueChange(e,t){let i=this.normalizeValue(e);if(!i){if(this.clearable){this._value=i,this.selectedTimeZoneItem=null;return}this._value=t,this.selectedTimeZoneItem=this.findTimeZoneItem(t);return}let l=this.findTimeZoneItem(i);if(!l){this._value=t;return}this._value=i,this.selectedTimeZoneItem=l,i!==e&&(await this.updateComplete,this.overrideSelectedLabelForRegion(this.open))}onLabelClick(){this.setFocus()}setComboboxRef(e){this.comboboxEl=e}overrideSelectedLabelForRegion(e){if(this.mode!=="region"||!this.selectedTimeZoneItem)return;let{label:t,metadata:i}=this.selectedTimeZoneItem;this.comboboxEl.selectedItems[0].textLabel=!i.country||e?t:le(t,i.country,this.messages)}onComboboxBeforeClose(e){e.stopPropagation(),this.overrideSelectedLabelForRegion(!1),this.calciteInputTimeZoneBeforeClose.emit()}onComboboxBeforeOpen(e){e.stopPropagation(),this.overrideSelectedLabelForRegion(!0),this.calciteInputTimeZoneBeforeOpen.emit()}onComboboxChange(e){e.stopPropagation();let t=e.target.selectedItems[0];if(!t){this._value="",this.selectedTimeZoneItem=null,this.calciteInputTimeZoneChange.emit();return}let i=this.findTimeZoneItemByLabel(t.getAttribute("data-label")),l=`${i.value}`;this.value===l&&i.label===this.selectedTimeZoneItem.label||(this._value=l,this.selectedTimeZoneItem=i,this.calciteInputTimeZoneChange.emit())}onComboboxClose(e){e.stopPropagation(),this.open=!1,this.calciteInputTimeZoneClose.emit()}onComboboxOpen(e){this.open=!0,e.stopPropagation(),this.calciteInputTimeZoneOpen.emit()}findTimeZoneItem(e){return K(this.timeZoneItems,"value",e)}findTimeZoneItemByLabel(e){return K(this.timeZoneItems,"label",e)}async updateTimeZoneItems(){this.timeZoneItems=await this.createTimeZoneItems()}updateTimeZoneSelection(){if(this.value===""&&this.clearable){this.selectedTimeZoneItem=null;return}let e=this.mode==="offset"?ie():se(),t=this.value===""||!this.value?e:this.value;this.selectedTimeZoneItem=this.findTimeZoneItem(t)||this.findTimeZoneItem(e)}async createTimeZoneItems(){return!this.messages._lang||!this.messages?[]:ne(this.messages._lang,this.messages,this.mode,this.referenceDate instanceof Date?this.referenceDate:new Date(this.referenceDate??Date.now()),this.offsetStyle)}normalizeValue(e){return e=e===void 0?"":e,e&&this.normalizer(e)}render(){return U({disabled:this.disabled,children:g`<calcite-combobox .clearDisabled=${!this.clearable} .disabled=${this.disabled} .label=${this.messages.chooseTimeZone} lang=${this.messages._lang??T} .maxItems=${this.maxItems} @calciteComboboxBeforeClose=${this.onComboboxBeforeClose} @calciteComboboxBeforeOpen=${this.onComboboxBeforeOpen} @calciteComboboxChange=${this.onComboboxChange} @calciteComboboxClose=${this.onComboboxClose} @calciteComboboxOpen=${this.onComboboxOpen} .overlayPositioning=${this.overlayPositioning} .placeholder=${this.mode==="name"?this.messages.namePlaceholder:this.mode==="offset"?this.messages.offsetPlaceholder:this.messages.regionPlaceholder} placeholder-icon=search .readOnly=${this.readOnly} .scale=${this.scale} .selectionMode=${this.clearable?"single":"single-persist"} .status=${this.status} .validationIcon=${this.validationIcon} .validationMessage=${this.validationMessage} ${R(this.setComboboxRef)}>${this.renderItems()}</calcite-combobox>${H({component:this})}`})}renderItems(){return this.mode==="region"?this.renderRegionItems():C(this.timeZoneItems,({label:e})=>e,e=>{let t=this.selectedTimeZoneItem===e,{label:i,metadata:l,value:u}=e;return g`<calcite-combobox-item data-label=${i??T} .metadata=${l} .selected=${t} .textLabel=${i} .value=${u}></calcite-combobox-item>`})}renderRegionItems(){return this.timeZoneItems.flatMap(({label:e,items:t})=>F(e,g`<calcite-combobox-item-group .label=${e}>${C(t,({label:i})=>i,i=>{let l=this.selectedTimeZoneItem===i,{label:u,metadata:d,value:Z}=i;return g`<calcite-combobox-item data-label=${u??T} .description=${d.country} .metadata=${d} .selected=${l} .textLabel=${u} .value=${Z}><span class=${L(ee.offset)} slot=content-end>${d.offset}</span></calcite-combobox-item>`})}</calcite-combobox-item-group>`))}};M("calcite-input-time-zone",O);export{O as InputTimeZone};
