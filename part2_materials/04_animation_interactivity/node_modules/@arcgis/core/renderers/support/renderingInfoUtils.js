/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.32/esri/copyright.txt for details.
*/
import e from"../../Color.js";import{RenderingInfo as t}from"./RenderingInfo.js";import{getVisualVariableValues as o}from"../visualVariables/support/visualVariableUtils.js";function i(e,t){if(null!=e.symbol)return e.symbol;const o=t?.renderer;return null!=o&&"dot-density"!==o.type?o.getSymbol(e,t):null}function r(e,r){const n=i(e,r);if(null==n)return null;const l=r?.renderer,a=new t(l,n);if(null==l||!("visualVariables"in l)||!l.visualVariables)return a;const s=o(l,e,r)??[],u=["proportional","proportional","proportional"];for(const{variable:t,value:o}of s)switch(t.type){case"color":a.color=o.toRgba();break;case"size":if("outline"===t.target)a.outlineSize=o;else{const e=t.axis,i=t.useSymbolValue?"symbol-value":o;switch(e){case"width":u[0]=i;break;case"depth":u[1]=i;break;case"height":u[2]=i;break;case"width-and-depth":u[0]=u[1]=i;break;default:u[0]=u[1]=u[2]=i}}break;case"opacity":a.opacity=o;break;case"rotation":switch(t.axis){case"tilt":a.tilt=o;break;case"roll":a.roll=o;break;default:a.heading=o}}return"proportional"===u[0]&&"proportional"===u[1]&&"proportional"===u[2]||(a.size=u),a}async function n(e,t){return null!=e.symbol?e.symbol:t?.renderer?.getSymbolAsync(e,t)??null}async function l(i,r){const l=await n(i,r);if(!l)return null;const a=r?.renderer,s=new t(a,l);if(!a||!("visualVariables"in a)||!a.visualVariables)return s;const u=o(a,i,r)??[],c=["proportional","proportional","proportional"];for(const{variable:t,value:o}of u)if("color"===t.type)s.color=e.toUnitRGBA(o);else if("size"===t.type)if("outline"===t.target)s.outlineSize=o;else{const e=t.axis,i=t.useSymbolValue?"symbol-value":o;"width"===e?c[0]=i:"depth"===e?c[1]=i:"height"===e?c[2]=i:c[0]=c[1]="width-and-depth"===e?i:c[2]=i}else"opacity"===t.type?s.opacity=o:"rotation"===t.type&&"tilt"===t.axis?s.tilt=o:"rotation"===t.type&&"roll"===t.axis?s.roll=o:"rotation"===t.type&&(s.heading=o);return(isFinite(c[0])||isFinite(c[1])||isFinite(c[2]))&&(s.size=c),s}function a(e,t=0){const o=e[t];return"number"==typeof o&&isFinite(o)?o:null}function s(e){for(let t=0;t<3;t++){const o=e[t];if("number"==typeof o)return isFinite(o)?o:0}return 0}export{a as getDriverAxisSizeValue,s as getDriverAxisSizeValueAny,r as getRenderingInfo,l as getRenderingInfoAsync,n as getSymbolAsync};
