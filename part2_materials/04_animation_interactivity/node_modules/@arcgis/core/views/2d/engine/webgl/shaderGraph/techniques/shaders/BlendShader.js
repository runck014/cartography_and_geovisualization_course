/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.32/esri/copyright.txt for details.
*/
import{_ as t,a as l}from"../../../../../../../chunks/tslib.es6.js";import{location as e,uniform as r,GraphShaderModule as n,define as i,VertexInput as a,UniformGroup as o,FragmentOutput as u,input as p,FragmentInput as s}from"../../GraphShaderModule.js";import{Vec4 as c,texture2D as d,ifElse as y,equal as m,Float as w,clamp as b,Vec3 as g,abs as f,max as k,min as C,step as v,cond as h,sqrt as x,lessThanEqual as j,greaterThan as T,dot as F,lessThan as M,Vec2 as O,Sampler2D as S}from"../../graph/glsl.js";import{uvToClip as B,oneMinus as G,minusOne as P,minusScalar as _}from"./utils.js";class q extends a{}t([e(0,O)],q.prototype,"position",void 0);class z extends s{}class A extends o{}t([r(S)],A.prototype,"layerTexture",void 0),t([r(S)],A.prototype,"backbufferTexture",void 0),t([r(w)],A.prototype,"opacity",void 0),t([r(w)],A.prototype,"inFadeOpacity",void 0);class D extends n{constructor(){super(...arguments),this.type="BlendShader"}vertex(t){return{uv:t.position,glPosition:new c(B(t.position),0,1)}}fragment(t){const l=new u,e=d(this.config.layerTexture,t.uv),r=d(this.config.backbufferTexture,t.uv),n=y(m(e.a,new w(0)),e.rgb,e.rgb.divide(e.a)),i=y(m(r.a,new w(0)),r.rgb,r.rgb.divide(r.a)),a=this.config.opacity.multiply(e.a),o=r.a;switch(this.blendMode){case"destination-over":l.fragColor=new c(n.multiply(a).multiply(G(o)).add(i.multiply(o)),a.add(o).subtract(a.multiply(o)));break;case"source-in":{const t=new c(n.multiply(a).multiply(o),a.multiply(o)),e=new c(i.multiply(o),o).multiply(G(this.config.opacity)).multiply(this.config.inFadeOpacity);l.fragColor=t.add(e)}break;case"destination-in":{const t=new c(i.multiply(o).multiply(a),o.multiply(a)),e=new c(i.multiply(o),o).multiply(new c(G(this.config.opacity).multiply(this.config.inFadeOpacity)));l.fragColor=t.add(e)}break;case"source-out":l.fragColor=new c(n.multiply(a).multiply(G(o)),a.multiply(G(o)));break;case"destination-out":l.fragColor=new c(i.multiply(o).multiply(G(a)),o.multiply(G(a)));break;case"source-atop":l.fragColor=new c(n.multiply(a).multiply(o).add(i.multiply(o.multiply(G(a)))),o);break;case"destination-atop":l.fragColor=new c(n.multiply(a.multiply(G(o))).add(i.multiply(o).multiply(a)),a);break;case"xor":l.fragColor=new c(n.multiply(a.multiply(G(o))).add(i.multiply(o.multiply(G(a)))),a.multiply(G(o)).add(o.multiply(G(a))));break;case"multiply":l.fragColor=new c(n.multiply(a).multiply(i.multiply(o)).add(n.multiply(a).multiply(G(o))).add(i.multiply(o).multiply(G(a))),a.add(o.multiply(G(a))));break;case"screen":l.fragColor=new c(n.add(i).subtract(n.multiply(i)).multiply(a.multiply(o)).add(n.multiply(a).multiply(G(o))).add(i.multiply(o).multiply(G(a))),a.add(o.multiply(G(a))));break;case"overlay":{const t=new g(H(i.r,n.r),H(i.g,n.g),H(i.b,n.b));l.fragColor=E(t,n,i,a,o)}break;case"darken":{const t=C(n,i);l.fragColor=E(t,n,i,a,o)}break;case"lighter":l.fragColor=new c(n.multiply(a).add(i.multiply(o)),a.add(o));break;case"lighten":{const t=k(n,i);l.fragColor=E(t,n,i,a,o)}break;case"color-dodge":{const t=b(new g(I(i.r,n.r),I(i.g,n.g),I(i.b,n.b)),new g(0),new g(1));l.fragColor=E(t,n,i,a,o)}break;case"color-burn":{const t=new g(J(i.r,n.r),J(i.g,n.g),J(i.b,n.b));l.fragColor=E(t,n,i,a,o)}break;case"hard-light":{const t=new g(K(i.r,n.r),K(i.g,n.g),K(i.b,n.b));l.fragColor=E(t,n,i,a,o)}break;case"soft-light":{const t=new g(L(i.r,n.r),L(i.g,n.g),L(i.b,n.b));l.fragColor=E(t,n,i,a,o)}break;case"difference":{const t=f(i.subtract(n));l.fragColor=E(t,n,i,a,o)}break;case"exclusion":{const t=n.add(i).subtract(new w(2).multiply(n).multiply(i));l.fragColor=E(t,n,i,a,o)}break;case"invert":l.fragColor=new c(new g(1).subtract(i).multiply(a).multiply(o).add(i.multiply(o).multiply(G(a))),o);break;case"vivid-light":{const t=new g(b(N(i.r,n.r),new w(0),new w(1)),b(N(i.g,n.g),new w(0),new w(1)),b(N(i.b,n.b),new w(0),new w(1)));l.fragColor=E(t,n,i,a,o)}break;case"hue":{const t=Y(n,i,i);l.fragColor=E(t,n,i,a,o)}break;case"saturation":{const t=Y(i,n,i);l.fragColor=E(t,n,i,a,o)}break;case"color":{const t=X(n,i);l.fragColor=E(t,n,i,a,o)}break;case"luminosity":{const t=X(i,n);l.fragColor=E(t,n,i,a,o)}break;case"plus":l.fragColor=b(new c(e.r.add(i.r),e.g.add(i.g),e.b.add(i.b),a.add(o)),new c(0),new c(1));break;case"minus":l.fragColor=new c(b(new g(i.r.subtract(e.r),i.g.subtract(e.g),i.b.subtract(e.b)),new g(0),new g(1)),o.multiply(a));break;case"average":{const t=i.add(n).divide(2);l.fragColor=E(t,n,i,a,o)}break;case"reflect":{const t=b(new g(Z(i.r,n.r),Z(i.g,n.g),Z(i.b,n.b)),new g(0),new g(1));l.fragColor=E(t,n,i,a,o)}break;default:l.fragColor=e.multiply(this.config.opacity)}return l}}function E(t,l,e,r,n){return new c(t.multiply(r).multiply(n).add(l.multiply(r).multiply(G(n))).add(e.multiply(n).multiply(G(r))),r.add(n.multiply(G(r))))}function H(t,l){return new w(1).subtract(v(new w(.5),l)).multiply(G(new w(2).multiply(G(l).multiply(G(t))))).add(v(new w(.5),l).multiply(new w(2).multiply(l).multiply(t)))}function I(t,l){return y(m(t,new w(0)),new w(0),y(m(l,new w(1)),new w(1),C(new w(1),t.divide(new w(1).subtract(l)))))}function J(t,l){return y(m(t,new w(1)),new w(1),y(m(l,new w(0)),new w(0),G(C(new w(1),G(t).divide(l)))))}function K(t,l){return new w(1).subtract(v(new w(.5),l)).multiply(new w(2).multiply(l).multiply(t)).add(v(new w(.5),l).multiply(G(new w(2).multiply(G(l).multiply(G(t))))))}function L(t,l){return h([j(l,new w(.5)),()=>{const e=new w(2).multiply(l),r=G(e),n=G(t);return t.subtract(r.multiply(t).multiply(n))}],[j(t,new w(.25)),()=>{const e=new w(2).multiply(l),r=P(e).multiply(t),n=new w(16).multiply(t).subtract(new w(12)).multiply(t).add(new w(3));return t.add(r.multiply(n))}],[!0,()=>{const e=new w(2).multiply(l),r=P(e),n=x(t).subtract(t);return t.add(r.multiply(n))}])}function N(t,l){const e=G(v(new w(.5),l)).multiply(J(t,new w(2).multiply(l))),r=v(new w(.5),l).multiply(I(t,new w(2).multiply(_(l,.5))));return e.add(r)}function Q(t){return C(C(t.r,t.g),t.b)}function R(t){return k(k(t.r,t.g),t.b)}function U(t){return F(t,new g(.3,.59,.11))}function V(t){return R(t).subtract(Q(t))}function W(t){const l=U(t),e=Q(t),r=R(t);return h([M(e,new w(0)),()=>{const r=t.subtract(l).multiply(l),n=l.subtract(e);return l.add(r.divide(n))}],[T(r,new w(1)),()=>{const e=t.subtract(l),n=G(l),i=e.multiply(n),a=r.subtract(l);return l.add(i.divide(a))}],[!0,t])}function X(t,l){const e=U(t),r=U(l).subtract(e);return W(t.add(new g(r)))}function Y(t,l,e){const r=Q(t),n=V(t),i=V(l);return X(y(T(n,new w(0)),(()=>t.subtract(r).multiply(i).divide(n)),new g(0)),e)}function Z(t,l){return y(m(l,new w(1)),l,(()=>{const e=G(l),r=t.multiply(t).divide(e);return C(r,new w(1))}))}t([i],D.prototype,"blendMode",void 0),t([r(A)],D.prototype,"config",void 0),t([l(0,p(q))],D.prototype,"vertex",null),t([l(0,p(z))],D.prototype,"fragment",null);export{D as BlendShader};
