/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.32/esri/copyright.txt for details.
*/
import{_ as e}from"../../../../chunks/tslib.es6.js";import t from"../../../../core/Accessor.js";import r from"../../../../core/Collection.js";import o from"../../../../core/ReactiveMap.js";import{property as s}from"../../../../core/accessorSupport/decorators/property.js";import"../../../../core/has.js";import"../../../../core/Logger.js";import"../../../../core/RandomLCG.js";import{subclass as a}from"../../../../core/accessorSupport/decorators/subclass.js";import{SketchHandlerMixin as i}from"../../mixins/SketchHandlerMixin.js";let c=class extends(i(t)){constructor(e){super(e),this.savedGraphics=new r,this.type="data-capture",this.pendingGraphics=new o}get collectionId(){return this.viewModel.collectionId}handleCreate(e){const{state:t,graphic:r,tool:o}=e,s=r?.geometry;if("complete"!==t||!r||!s)return;const{collectionId:a,viewModel:{dataCaptureLayer:i,currentBestFeature:c,imageGeometryField:d,oiObjectIdField:n},pendingGraphics:l}=this;c&&d&&a&&n&&(p(r,s,d,n,c,l,a,i),this.viewModel.emit("after-data-capture-complete",{pendingGraphics:l.get(a)?.toArray()??null}),this.viewModel.sketch?.create(o))}handleDelete(e){const{dataCaptureLayer:t}=this.viewModel;if(!t)return;const{graphics:r}=e;this.pendingGraphics.get(t.id)?.removeMany(r),this.savedGraphics.removeMany(r),this.viewModel.deleteDataCaptureFeatures(d(r,t.objectIdField))}handleDestroy(){const{dataCaptureLayer:e}=this.viewModel;e&&(this.viewModel.stopDataCapture(),this.savedGraphics.removeAll(),this.pendingGraphics=null)}handleUpdate(e){const{toolEventInfo:t,state:r,graphics:o}=e;if(t)this.viewModel.sketch?.undo();else switch(r){case"complete":this.viewModel.emit("deselect-data-capture-features",{graphics:o});break;case"start":this.viewModel.emit("select-data-capture-features",{graphics:o})}}};function p(e,t,o,s,a,i,c,p){e.sourceLayer=p,e.attributes=e.attributes??{},e.attributes[o]=btoa(JSON.stringify({geometry:t.toJSON()})),e.attributes[s]=a.attributes.objectId,i.has(c)||i.set(c,new r);i.get(c).add(e)}function d(e,t){return e.map((({attributes:e})=>t?e[t]:null)).filter(Boolean)}e([s()],c.prototype,"collectionId",null),e([s()],c.prototype,"savedGraphics",void 0),e([s()],c.prototype,"type",void 0),e([s()],c.prototype,"pendingGraphics",void 0),c=e([a("esri.widgets.OrientedImageryViewer.adapters.sketch.DataCaptureAdapter")],c);const n=c;export{n as default};
