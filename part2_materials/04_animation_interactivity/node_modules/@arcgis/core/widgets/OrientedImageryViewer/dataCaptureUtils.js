/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.32/esri/copyright.txt for details.
*/
import e from"../../Graphic.js";import t from"../../core/Error.js";import{fromJSON as o}from"../../geometry/support/jsonUtils.js";import{or as r}from"../../layers/orientedImagery/transformations/utils.js";import{defaultOIObjectIDField as n,defaultImageGeometryField as i}from"./constants.js";import{createGraphicSymbol as l,dataCaptureFeatureSymbol as y}from"./symbols.js";function m(e,t,o){const n=e.toLowerCase(),i=t.toLowerCase()===n,l=o?.toLowerCase()===n;return r(i,l)}function s(e){return"point"===e||"polygon"===e||"polyline"===e}function a(e,t,o){return s(e.geometryType)&&2===e.fields.filter((({name:e,type:r,alias:l})=>m(o?.length?o:n,e,l)||m(t?.length?t:i,e,l)&&"blob"===r)).length}function f(e){return"feature"===e.type&&p(e)}function p(e){return"point"===e.geometryType||"polygon"===e.geometryType||"polyline"===e.geometryType}function u(e,t,o){if(!e)return;const{renderer:r}=e,n=y(t),i=r?"symbol"in r?r.symbol:"defaultSymbol"in r?r.defaultSymbol:r.getSymbol():null,l=n(i?.color);o[`${t}Symbol`]=(t===e.geometryType?i:null)??l}function c(e,o,r){const l=e.fields.find((({name:e,alias:t,type:r})=>m(o?.length?o:i,e,t)&&"blob"===r)),y=e.fields.find((({name:e,alias:t})=>m(r?.length?r:n,e,t)));if(!l||!y)throw new t("invalid-data-capture-layer","Data capture layer is not configured correctly.",{layer:e,imageGeometryField:l,oiObjectIdField:y});return{imageGeometryField:l,oiObjectIdField:y}}function g(o,r,n,i,y){const m=d(o,r);if(!m)throw new t("InvalidGeometry");return new e({attributes:o,layer:n,symbol:l(m.type,n.geometryType,y),geometry:m,visible:n.visible&&i})}function d(e,t){const{geometry:r}=JSON.parse(atob(e[t]));return o(r)}export{u as configureSketchTool,g as constructGraphicFromImageGeometry,c as extractFieldsFromDataCaptureLayer,a as isValidDataCaptureLayer,f as isValidOverlayLayer,d as parseAndExtractField,p as supportedDigitigedGeometryType};
